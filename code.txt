c:/AutFinanceBank/src/Assets/mailbody.js
<DOCUMENT>
function generateOtpEmail(date, reason, otp) {
    const formattedDate = new Date(date).toLocaleString(); // Format the date
    
    const htmlTemplate = `
    <!DOCTYPE html>
    <html lang="en">
      <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="X-UA-Compatible" content="ie=edge" />
        <title>OTP</title>
        <link
          href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap"
          rel="stylesheet"
        />
      </head>
      <body
        style="
          margin: 0;
          font-family: 'Poppins', sans-serif;
          background: #ffffff;
          font-size: 14px;
        "
      >
        <div
          style="
            max-width: 680px;
            margin: 0 auto;
            padding: 45px 30px 60px;
            background: #f4f7ff;
            background-image: url(https://archisketch-resources.s3.ap-northeast-2.amazonaws.com/vrstyler/1661497957196_595865/email-template-background-banner);
            background-repeat: no-repeat;
            background-size: 800px 452px;
            background-position: top center;
            font-size: 14px;
            color: #434343;
          "
        >
          <header>
            <table style="width: 100%;">
              <tbody>
                <tr style="height: 0;">
                  <td>
                    <img
                      alt="AUT Bank Logo"
                      src="https://raw.githubusercontent.com/ahad324/BankManagementSystemCpp/main/Logo.jpeg"
                      height="100px"
                    />
                  </td>
                  <td style="text-align: right;">
                    <span
                      style="font-size: 16px; line-height: 30px; color: #ffffff;"
                      >${formattedDate}</span
                    >
                  </td>
                </tr>
              </tbody>
            </table>
          </header>
  
          <main>
            <div
              style="
                margin: 0;
                margin-top: 70px;
                padding: 92px 30px 115px;
                background: #ffffff;
                border-radius: 30px;
                text-align: center;
                box-shadow:0 0 20px rgba(0,0,0,0.5);
              "
            >
              <div style="width: 100%; max-width: 489px; margin: 0 auto;">
                <h1
                  style="
                    margin: 0;
                    font-size: 24px;
                    font-weight: 500;
                    color: #1f1f1f;
                  "
                >
                  Your OTP
                </h1>
                <p
                  style="
                    margin: 0;
                    margin-top: 17px;
                    font-size: 16px;
                    font-weight: 500;
                  "
                >
                  Hey Welcome !,
                </p>
                <p
                  style="
                    margin: 0;
                    margin-top: 17px;
                    font-weight: 500;
                    letter-spacing: 0.56px;
                  "
                >
                  Thank you for choosing AUT Finance Bank. Use the following OTP
                  to complete the procedure of ${reason}. OTP is
                  valid for
                  <span style="font-weight: 600; color: #1f1f1f;">5 minutes</span>.<br />
                  Do not share this code with others.
                </p>
                <p
                  style="
                    margin: 0;
                    margin-top: 60px;
                    font-size: 40px;
                    font-weight: 600;
                    letter-spacing: 25px;
                    color: #ba3d4f;
                  "
                >
                  ${otp}
                </p>
              </div>
            </div>
  
            <p
              style="
                max-width: 400px;
                margin: 0 auto;
                margin-top: 90px;
                text-align: center;
                font-weight: 500;
                color: #8c8c8c;
              "
            >
              Need help? Ask at
              <a
                href="mailto:autfinance.bank@gmail.com"
                style="color: #499fb6; text-decoration: none;"
                >autfinance.bank@gmail.com</a
              >
              or visit our
              <a
                href="https://bmscpp.netlify.app/"
                target="_blank"
                style="color: #499fb6; text-decoration: none;"
                >Help Center</a
              >
            </p>
          </main>
  
          <footer
            style="
              width: 100%;
              max-width: 490px;
              margin: 20px auto 0;
              text-align: center;
              border-top: 1px solid #e6ebf1;
            "
          >
            <p
              style="
                margin: 0;
                margin-top: 40px;
                font-size: 16px;
                font-weight: 600;
                color: #434343;
              "
            >
              AUT Finance Bank
            </p>
            <p style="margin: 0; margin-top: 8px; color: #434343;">
              Address 540, Lahore, Punjab.
            </p>
            <div style="margin: 0; margin-top: 16px;">
              <a href="" target="_blank" style="display: inline-block;">
                <img
                  width="36px"
                  alt="Facebook"
                  src="https://archisketch-resources.s3.ap-northeast-2.amazonaws.com/vrstyler/1661502815169_682499/email-template-icon-facebook"
                />
              </a>
              <a
                href=""
                target="_blank"
                style="display: inline-block; margin-left: 8px;"
              >
                <img
                  width="36px"
                  alt="Instagram"
                  src="https://archisketch-resources.s3.ap-northeast-2.amazonaws.com/vrstyler/1661504218208_684135/email-template-icon-instagram"
                />
              </a>
              <a
                href=""
                target="_blank"
                style="display: inline-block; margin-left: 8px;"
              >
                <img
                  width="36px"
                  alt="Twitter"
                  src="https://archisketch-resources.s3.ap-northeast-2.amazonaws.com/vrstyler/1661503043040_372004/email-template-icon-twitter"
                />
              </a>
              <a
                href=""
                target="_blank"
                style="display: inline-block; margin-left: 8px;"
              >
                <img
                  width="36px"
                  alt="Youtube"
                  src="https://archisketch-resources.s3.ap-northeast-2.amazonaws.com/vrstyler/1661503195931_210869/email-template-icon-youtube"
                />
              </a>
            </div>
            <p style="margin: 0; margin-top: 16px; color: #434343;">
              Copyright ¬© 2024 Company. All rights reserved.
            </p>
          </footer>
        </div>
      </body>
    </html>
    `;
    return htmlTemplate;
  }
  export default generateOtpEmail;
</DOCUMENT>

c:/AutFinanceBank/src/context/AuthContext.js
<DOCUMENT>
import React, { createContext, useState, useEffect } from 'react';
import AsyncStorage from '@react-native-async-storage/async-storage';
import api from '../services/api';

export const AuthContext = createContext();

export const AuthProvider = ({ children }) => {
  const [user, setUser] = useState(null);
  const [isLoading, setIsLoading] = useState(true);

  const login = async (loginId, password) => {
    try {
      const response = await api.post('/api/v1/users/login', { login_id: loginId, Password: password });
      console.log('AuthContext: Login response:', response.data);
      const { success, message, data } = response.data;
      if (!success || !data) {
        return { success: false, message: message || 'Invalid response from server' };
      }

      const { access_token, refresh_token, ...userData } = data;
      if (!access_token || !userData.UserID) {
        return { success: false, message: 'Invalid user data received' };
      }
      console.log('AuthContext: User data:', userData);

      await AsyncStorage.setItem('accessToken', access_token);
      await AsyncStorage.setItem('refreshToken', refresh_token);
      await AsyncStorage.setItem('userData', JSON.stringify(userData));

      const userWithToken = { ...userData, access_token };
      setUser(userWithToken);

      return { success: true };
    } catch (error) {
      console.error('AuthContext: Login error:', error.response?.data || error.message);
      return { success: false, message: error.response?.data?.detail || 'Login failed' };
    }
  };

  const logout = async () => {
    try {
      await AsyncStorage.removeItem('accessToken');
      await AsyncStorage.removeItem('refreshToken');
      await AsyncStorage.removeItem('userData');
      setUser(null);
      return { success: true };
    } catch (error) {
      console.error('AuthContext: Logout error:', error);
      return { success: false, message: 'Logout failed' };
    }
  };

  useEffect(() => {
    const initializeAuth = async () => {
      try {
        const userData = await AsyncStorage.getItem('userData');
        const accessToken = await AsyncStorage.getItem('accessToken');
        console.log('AuthContext: AsyncStorage contents:', { userData, accessToken });

        if (userData && accessToken) {
          let parsedUser;
          try {
            parsedUser = JSON.parse(userData);
          } catch (error) {
            console.error('AuthContext: Failed to parse userData:', error);
            await AsyncStorage.removeItem('userData');
            setIsLoading(false);
            return;
          }
          if (parsedUser.UserID) {
            parsedUser.access_token = accessToken;
            console.log('AuthContext: Parsed user data:', Object.keys(parsedUser));
            setUser(parsedUser);
          }
        }
      } catch (error) {
        console.error('AuthContext: Initialization error:', error);
      } finally {
        setIsLoading(false);
      }
    };

    initializeAuth();
  }, []);

  return (
    <AuthContext.Provider value={{ user, login, logout, isLoading }}>
      {children}
    </AuthContext.Provider>
  );
};
</DOCUMENT>

c:/AutFinanceBank/src/navigation/AppNavigator.js
<DOCUMENT>
import React, { useContext } from 'react';
import { NavigationContainer } from '@react-navigation/native';
import { createNativeStackNavigator } from '@react-navigation/native-stack';
import { createBottomTabNavigator } from '@react-navigation/bottom-tabs';
import Icon from 'react-native-vector-icons/MaterialIcons';
import { AuthContext } from '../context/AuthContext';
import WelcomeScreen from '../screens/WelcomeScreen';
import OnboardingScreen from '../screens/OnboardingScreen';
import LoginScreen from '../screens/LoginScreen';
import SignupStep1 from '../screens/SignupStep/SignupStep1';
import SignupStep2 from '../screens/SignupStep/SignupStep2';
import SignupStep3 from '../screens/SignupStep/SignupStep3';
import SignupStep4 from '../screens/SignupStep/SignupStep4';
import SignupStep5 from '../screens/SignupStep/SignupStep5';
import SignupStep6 from '../screens/SignupStep/SignupStep6';
import ForgotPasswordScreen from '../screens/ForgotPasswordScreen';
import HomeScreen from '../screens/HomeScreen';
import SendScreen from '../screens/SendScreen';
import DepositScreen from '../screens/DepositScreen';
import LoanScreen from '../screens/LoanScreen';
import TransactionsScreen from '../screens/TransactionsScreen';
import WithdrawScreen from '../screens/WithdrawScreen';
import CardsScreen from '../screens/CardsScreen';
import QRCodeScreen from '../screens/QRCodeScreen';
import NotificationsScreen from '../screens/NotificationsScreen';
import HistoryScreen from '../screens/HistoryScreen';
import SettingsScreen from '../screens/SettingsScreen';
import ProfileScreen from '../screens/ProfileScreen';
import ScanQRScreen from '../screens/ScanQRScreen';
import RecipientScreen from '../screens/RecipientScreen';
import SplashScreen from '../screens/SplashScreen';
import { View, Text } from 'react-native';

const Stack = createNativeStackNavigator();
const Tab = createBottomTabNavigator();

const AppTabs = () => {
  const context = useContext(AuthContext);
  const user = context?.user;

  console.log('AppTabs: Rendering, user:', user ? Object.keys(user) : 'undefined', 'context:', !!context);

  if (!user) {
    console.log('AppTabs: No user, skipping render');
    return null; // Prevent rendering tabs if not authenticated
  }

  return (
    <Tab.Navigator
      screenOptions={{
        tabBarStyle: { height: 60, paddingBottom: 5 },
        tabBarLabelStyle: { fontSize: 12 },
        tabBarActiveTintColor: '#3498db',
        tabBarInactiveTintColor: '#7f8c8d',
        headerShown: false,
      }}
      initialRouteName="HomeTab"
    >
      <Tab.Screen
        name="HomeTab"
        component={HomeScreen}
        options={{
          tabBarLabel: 'Home',
          tabBarIcon: ({ color }) => <Icon name="home" size={24} color={color} />,
        }}
        listeners={{
          focus: () => console.log('AppTabs: HomeTab focused, user:', user ? Object.keys(user) : 'undefined'),
        }}
      />
      <Tab.Screen
        name="HistoryTab"
        component={HistoryScreen}
        options={{
          tabBarLabel: 'History',
          tabBarIcon: ({ color }) => <Icon name="history" size={24} color={color} />,
        }}
      />
      <Tab.Screen
        name="ScanQR"
        component={ScanQRScreen}
        options={{
          tabBarIcon: ({ color }) => <Icon name="qr-code" size={32} color={color} />,
          tabBarLabel: '',
        }}
      />
      <Tab.Screen
        name="SettingsTab"
        component={SettingsScreen}
        options={{
          tabBarLabel: 'Settings',
          tabBarIcon: ({ color }) => <Icon name="settings" size={24} color={color} />,
        }}
      />
      <Tab.Screen
        name="ProfileTab"
        component={ProfileScreen}
        options={{
          tabBarLabel: 'Profile',
          tabBarIcon: ({ color }) => <Icon name="person" size={24} color={color} />,
        }}
      />
    </Tab.Navigator>
  );
};

const AppNavigator = () => {
  const context = useContext(AuthContext);
  const user = context?.user;
  const isLoading = context?.isLoading;

  console.log('AppNavigator: Rendering, isLoading:', isLoading, 'user:', user ? Object.keys(user) : 'undefined', 'context:', !!context);

  if (!context) {
    console.error('AppNavigator: AuthContext is undefined');
    return (
      <NavigationContainer>
        <Stack.Navigator>
          <Stack.Screen
            name="Error"
            component={() => (
              <View style={{ flex: 1, justifyContent: 'center', alignItems: 'center' }}>
                <Text>Authentication error. Please restart the app.</Text>
              </View>
            )}
            options={{ headerShown: false }}
          />
        </Stack.Navigator>
      </NavigationContainer>
    );
  }

  if (isLoading) {
    console.log('AppNavigator: Showing splash screen due to isLoading');
    return (
      <NavigationContainer>
        <Stack.Navigator>
          <Stack.Screen
            name="Splash"
            component={SplashScreen}
            options={{ headerShown: false }}
          />
        </Stack.Navigator>
      </NavigationContainer>
    );
  }

  return (
    <NavigationContainer>
      <Stack.Navigator
        initialRouteName={user ? 'Home' : 'Welcome'}
        screenOptions={{ headerShown: false }}
      >
        {!user ? (
          <>
            <Stack.Screen
              name="Welcome"
              component={SplashScreen}
              listeners={{
                focus: () => console.log('Navigation: Focused on Welcome'),
              }}
            />
            <Stack.Screen
              name="Onboarding"
              component={OnboardingScreen}
              listeners={{
                focus: () => console.log('Navigation: Focused on Onboarding'),
              }}
            />
            <Stack.Screen
              name="Login"
              component={LoginScreen}
              listeners={{
                focus: () => console.log('Navigation: Focused on Login'),
              }}
            />
            <Stack.Screen name="SignupStep1" component={SignupStep1} />
            <Stack.Screen name="SignupStep2" component={SignupStep2} />
            <Stack.Screen name="SignupStep3" component={SignupStep3} />
            <Stack.Screen name="SignupStep4" component={SignupStep4} />
            <Stack.Screen name="SignupStep5" component={SignupStep5} />
            <Stack.Screen name="SignupStep6" component={SignupStep6} />
            <Stack.Screen name="ForgotPassword" component={ForgotPasswordScreen} />
          </>
        ) : (
          <>
            <Stack.Screen
              name="Home"
              component={AppTabs}
              listeners={{
                focus: () =>
                  console.log('Navigation: Focused on Home (AppTabs), user:', user ? Object.keys(user) : 'undefined'),
              }}
            />
            <Stack.Screen name="Send" component={SendScreen} />
            <Stack.Screen name="Deposit" component={DepositScreen} />
            <Stack.Screen name="Loan" component={LoanScreen} />
            <Stack.Screen name="Transactions" component={TransactionsScreen} />
            <Stack.Screen name="Withdraw" component={WithdrawScreen} />
            <Stack.Screen name="Cards" component={CardsScreen} />
            <Stack.Screen name="QRCode" component={QRCodeScreen} />
            <Stack.Screen name="Notifications" component={NotificationsScreen} />
            <Stack.Screen name="RecipientScreen" component={RecipientScreen} />
          </>
        )}
      </Stack.Navigator>
    </NavigationContainer>
  );
};

export default AppNavigator;
</DOCUMENT>

c:/AutFinanceBank/src/screens/CardsScreen.js
<DOCUMENT>
import React, { useState, useContext } from 'react';
import { View, Text, TextInput, TouchableOpacity, FlatList, StyleSheet, Modal } from 'react-native';
import { useQuery, useMutation } from 'react-query';
import { AuthContext } from '../context/AuthContext';
import { getCards, createCard, updateCard, deleteCard } from '../services/cardService';
import { CardCreateSchema, CardUpdateSchema } from '../utils/validators';
import { formatDate } from '../utils/helpers';
import globalStyles from '../styles/globalStyles';

const CardsScreen = () => {
  const { user } = useContext(AuthContext);
  const [showModal, setShowModal] = useState(false);
  const [cardNumber, setCardNumber] = useState('');
  const [pin, setPin] = useState('');
  const [expirationDate, setExpirationDate] = useState('');
  const [errorMessage, setErrorMessage] = useState('');

  const { data: cards, isLoading, refetch } = useQuery('cards', () => getCards({ page: 1, per_page: 10 }), {
    enabled: !!user,
  });

  const createMutation = useMutation(createCard, {
    onSuccess: () => {
      setShowModal(false);
      setCardNumber('');
      setPin('');
      setExpirationDate('');
      refetch();
    },
    onError: (error) => setErrorMessage(error.message),
  });

  const updateMutation = useMutation(({ cardId, cardData }) => updateCard(cardId, cardData), {
    onSuccess: refetch,
    onError: (error) => setErrorMessage(error.message),
  });

  const deleteMutation = useMutation(deleteCard, {
    onSuccess: refetch,
    onError: (error) => setErrorMessage(error.message),
  });

  const handleCreateCard = async () => {
    setErrorMessage('');
    try {
      const cardData = { CardNumber: cardNumber, Pin: pin, ExpirationDate: formatDate(expirationDate) };
      await CardCreateSchema.validate(cardData);
      createMutation.mutate(cardData);
    } catch (error) {
      setErrorMessage(error.message);
    }
  };

  const handleUpdateStatus = async (cardId, status) => {
    try {
      await CardUpdateSchema.validate({ Status: status });
      updateMutation.mutate({ cardId, cardData: { Status: status } });
    } catch (error) {
      setErrorMessage(error.message);
    }
  };

  const renderCard = ({ item }) => (
    <View style={styles.card}>
      <Text style={styles.cardText}>Card Number: {item.CardNumber}</Text>
      <Text style={styles.cardText}>Expiration: {item.ExpirationDate}</Text>
      <Text style={styles.cardText}>Status: {item.Status}</Text>
      <View style={styles.cardActions}>
        <TouchableOpacity
          style={[styles.actionButton, item.Status === 'Active' && { opacity: 0.5 }]}
          onPress={() => handleUpdateStatus(item.CardID, 'Active')}
          disabled={item.Status === 'Active'}
        >
          <Text style={styles.actionText}>Activate</Text>
        </TouchableOpacity>
        <TouchableOpacity
          style={[styles.actionButton, item.Status === 'Blocked' && { opacity: 0.5 }]}
          onPress={() => handleUpdateStatus(item.CardID, 'Blocked')}
          disabled={item.Status === 'Blocked'}
        >
          <Text style={styles.actionText}>Block</Text>
        </TouchableOpacity>
        <TouchableOpacity
          style={styles.actionButton}
          onPress={() => deleteMutation.mutate(item.CardID)}
        >
          <Text style={styles.actionText}>Delete</Text>
        </TouchableOpacity>
      </View>
    </View>
  );

  if (!user) {
    return (
      <View style={globalStyles.container}>
        <Text>Please log in to view cards</Text>
      </View>
    );
  }

  return (
    <View style={globalStyles.container}>
      <Text style={[globalStyles.textXLargeBlack, { marginBottom: globalStyles.SPACING.large }]}>
        Your Cards
      </Text>
      {isLoading ? (
        <Text>Loading cards...</Text>
      ) : (
        <FlatList
          data={cards?.data || []}
          renderItem={renderCard}
          keyExtractor={(item) => item.CardID.toString()}
        />
      )}
      <TouchableOpacity
        style={globalStyles.button}
        onPress={() => setShowModal(true)}
      >
        <Text style={globalStyles.buttonText}>Add New Card</Text>
      </TouchableOpacity>
      {errorMessage ? <Text style={globalStyles.textError}>{errorMessage}</Text> : null}

      <Modal visible={showModal} animationType="slide">
        <View style={globalStyles.container}>
          <Text style={[globalStyles.textXLargeBlack, { marginBottom: globalStyles.SPACING.large }]}>
            Add New Card
          </Text>
          <TextInput
            style={globalStyles.input}
            placeholder="Card Number (16 digits)"
            keyboardType="numeric"
            value={cardNumber}
            onChangeText={setCardNumber}
            maxLength={16}
          />
          <TextInput
            style={globalStyles.input}
            placeholder="PIN (4 digits)"
            keyboardType="numeric"
            secureTextEntry
            value={pin}
            onChangeText={setPin}
            maxLength={4}
          />
          <TextInput
            style={globalStyles.input}
            placeholder="Expiration Date (YYYY-MM-DD)"
            value={expirationDate}
            onChangeText={setExpirationDate}
          />
          {errorMessage ? <Text style={globalStyles.textError}>{errorMessage}</Text> : null}
          <TouchableOpacity
            style={[globalStyles.button, createMutation.isLoading && { opacity: 0.7 }]}
            onPress={handleCreateCard}
            disabled={createMutation.isLoading}
          >
            <Text style={globalStyles.buttonText}>
              {createMutation.isLoading ? 'Adding...' : 'Add Card'}
            </Text>
          </TouchableOpacity>
          <TouchableOpacity
            style={globalStyles.buttonOutline}
            onPress={() => setShowModal(false)}
          >
            <Text style={globalStyles.buttonOutlineText}>Cancel</Text>
          </TouchableOpacity>
        </View>
      </Modal>
    </View>
  );
};

const styles = StyleSheet.create({
  card: {
    backgroundColor: globalStyles.COLORS.gray,
    borderRadius: 8,
    padding: 16,
    marginVertical: 8,
  },
  cardText: {
    fontSize: globalStyles.FONT_SIZES.medium,
    color: globalStyles.COLORS.text,
  },
  cardActions: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    marginTop: 8,
  },
  actionButton: {
    backgroundColor: globalStyles.COLORS.primary,
    padding: 8,
    borderRadius: 5,
  },
  actionText: {
    color: globalStyles.COLORS.white,
    fontSize: globalStyles.FONT_SIZES.small,
  },
});

export default CardsScreen;
</DOCUMENT>

c:/AutFinanceBank/src/screens/DepositScreen.js
<DOCUMENT>
import React from 'react';
import { View, Text } from 'react-native';

const DepositScreen = () => (
  <View style={{ flex: 1, justifyContent: 'center', alignItems: 'center' }}>
    <Text>Deposit Screen</Text>
  </View>
);

export default DepositScreen;
</DOCUMENT>

c:/AutFinanceBank/src/screens/ForgotPasswordScreen.js
<DOCUMENT>
import React, { useState } from 'react';
import { View, Text, TextInput, TouchableOpacity, KeyboardAvoidingView, ScrollView, Platform, StyleSheet } from 'react-native';
import { sendOtpForPasswordReset, verifyOtpAndResetPassword } from '../services/api';
import globalStyles from '../styles/globalStyles';

const ForgotPasswordScreen = ({ navigation }) => {
  const [step, setStep] = useState(1);
  const [email, setEmail] = useState('');
  const [otp, setOtp] = useState('');
  const [newPassword, setNewPassword] = useState('');
  const [confirmNewPassword, setConfirmNewPassword] = useState('');
  const [showNewPassword, setShowNewPassword] = useState(false);
  const [showConfirmNewPassword, setShowConfirmNewPassword] = useState(false);
  const [errorMessage, setErrorMessage] = useState('');
  const [isLoading, setIsLoading] = useState(false);

  const handleSendOtp = async () => {
    setErrorMessage('');
    if (!email) {
      setErrorMessage('Email is required');
      return;
    }
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(email)) {
      setErrorMessage('Please enter a valid email address');
      return;
    }

    setIsLoading(true);
    try {
      const result = await sendOtpForPasswordReset(email);
      if (result.success) {
        setStep(2);
      } else {
        setErrorMessage(result.message);
      }
    } catch (error) {
      setErrorMessage('An unexpected error occurred: ' + error.message);
      console.error('ForgotPasswordScreen sendOtp error:', error);
    } finally {
      setIsLoading(false);
    }
  };

  const handleResetPassword = async () => {
    setErrorMessage('');
    if (!otp || otp.length !== 6) {
      setErrorMessage('Please enter a valid 6-digit OTP');
      return;
    }
    if (!newPassword || newPassword.length < 6) {
      setErrorMessage('New password must be at least 6 characters long');
      return;
    }
    if (newPassword !== confirmNewPassword) {
      setErrorMessage('Passwords do not match');
      return;
    }

    setIsLoading(true);
    try {
      const result = await verifyOtpAndResetPassword(email, otp, newPassword);
      if (result.success) {
        setErrorMessage('');
        alert('Password reset successfully! Please log in with your new password.');
        navigation.replace('Login');
      } else {
        setErrorMessage(result.message);
      }
    } catch (error) {
      setErrorMessage('An unexpected error occurred: ' + error.message);
      console.error('ForgotPasswordScreen resetPassword error:', error);
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <KeyboardAvoidingView
      style={{ flex: 1 }}
      behavior={Platform.OS === 'ios' ? 'padding' : 'height'}
      keyboardVerticalOffset={Platform.OS === 'ios' ? 0 : 20}
    >
      <ScrollView contentContainerStyle={{ flexGrow: 1 }}>
        <View style={[globalStyles.container, { justifyContent: 'space-between' }]}>
          <View>
            <View style={[globalStyles.logoContainer, { marginLeft: globalStyles.SPACING.medium, marginTop: globalStyles.SPACING.large }]}>
              <View style={[globalStyles.circle, globalStyles.circlePrimary]} />
              <View style={[globalStyles.circle, globalStyles.circleSecondary]} />
            </View>

            <Text style={[globalStyles.textXLargeBlack, { marginBottom: globalStyles.SPACING.large, alignSelf: 'center' }]}>
              Forgot Password
            </Text>

            {step === 1 ? (
              <>
                <TextInput
                  style={[globalStyles.input, { color: globalStyles.COLORS.text, alignSelf: 'center' }]}
                  placeholder="Email Address"
                  placeholderTextColor={globalStyles.COLORS.placeholder}
                  keyboardType="email-address"
                  value={email}
                  onChangeText={setEmail}
                  autoCapitalize="none"
                  editable={!isLoading}
                />

                {errorMessage ? <Text style={[globalStyles.textError, { alignSelf: 'center' }]}>{errorMessage}</Text> : null}

                <TouchableOpacity
                  style={[globalStyles.button, isLoading && { opacity: 0.7 }, { alignSelf: 'center' }]}
                  onPress={handleSendOtp}
                  disabled={isLoading}
                >
                  <Text style={globalStyles.buttonText}>{isLoading ? 'Sending OTP...' : 'Send OTP'}</Text>
                </TouchableOpacity>
              </>
            ) : (
              <>
                <TextInput
                  style={[globalStyles.input, { color: globalStyles.COLORS.text, alignSelf: 'center' }]}
                  placeholder="Enter OTP"
                  placeholderTextColor={globalStyles.COLORS.placeholder}
                  keyboardType="numeric"
                  value={otp}
                  onChangeText={setOtp}
                  maxLength={6}
                  editable={!isLoading}
                />

                <View style={{ position: 'relative', width: '100%', alignSelf: 'center' }}>
                  <TextInput
                    style={[globalStyles.input, { color: globalStyles.COLORS.text }]}
                    placeholder="New Password"
                    placeholderTextColor={globalStyles.COLORS.placeholder}
                    secureTextEntry={!showNewPassword}
                    value={newPassword}
                    onChangeText={setNewPassword}
                    editable={!isLoading}
                  />
                  <TouchableOpacity
                    style={styles.eyeIcon}
                    onPress={() => setShowNewPassword(!showNewPassword)}
                  >
                    <Text>{showNewPassword ? 'üëÅÔ∏è' : 'üëÅÔ∏è‚Äçüó®Ô∏è'}</Text>
                  </TouchableOpacity>
                </View>

                <View style={{ position: 'relative', width: '100%', alignSelf: 'center' }}>
                  <TextInput
                    style={[globalStyles.input, { color: globalStyles.COLORS.text }]}
                    placeholder="Confirm New Password"
                    placeholderTextColor={globalStyles.COLORS.placeholder}
                    secureTextEntry={!showConfirmNewPassword}
                    value={confirmNewPassword}
                    onChangeText={setConfirmNewPassword}
                    editable={!isLoading}
                  />
                  <TouchableOpacity
                    style={styles.eyeIcon}
                    onPress={() => setShowConfirmNewPassword(!showConfirmNewPassword)}
                  >
                    <Text>{showConfirmNewPassword ? 'üëÅÔ∏è' : 'üëÅÔ∏è‚Äçüó®Ô∏è'}</Text>
                  </TouchableOpacity>
                </View>

                {errorMessage ? <Text style={[globalStyles.textError, { alignSelf: 'center' }]}>{errorMessage}</Text> : null}

                <TouchableOpacity
                  style={[globalStyles.button, isLoading && { opacity: 0.7 }, { alignSelf: 'center' }]}
                  onPress={handleResetPassword}
                  disabled={isLoading}
                >
                  <Text style={globalStyles.buttonText}>{isLoading ? 'Resetting...' : 'Reset Password'}</Text>
                </TouchableOpacity>
              </>
            )}

            <TouchableOpacity onPress={() => navigation.navigate('Login')}>
              <Text style={[globalStyles.text, styles.backToLoginLink]}>Back to Login</Text>
            </TouchableOpacity>
          </View>

          <View style={styles.footer}>
            <View style={styles.footerLine} />
            <Text style={styles.footerText}>Your Trusted Banking Partner</Text>
            <View style={styles.footerLine} />
          </View>
        </View>
      </ScrollView>
    </KeyboardAvoidingView>
  );
};

const styles = StyleSheet.create({
  eyeIcon: {
    position: 'absolute',
    right: 10,
    top: '50%',
    transform: [{ translateY: -10 }],
  },
  backToLoginLink: {
    color: globalStyles.COLORS.primary,
    textAlign: 'center',
    marginVertical: globalStyles.SPACING.small,
    textDecorationLine: 'underline',
    alignSelf: 'center',
  },
  footer: {
    alignItems: 'center',
    marginBottom: globalStyles.SPACING.large,
  },
  footerLine: {
    width: '80%',
    height: 2,
    backgroundColor: globalStyles.COLORS.primary,
    marginVertical: globalStyles.SPACING.small,
  },
  footerText: {
    fontSize: 16,
    color: globalStyles.COLORS.text,
    fontStyle: 'italic',
  },
});

export default ForgotPasswordScreen;
</DOCUMENT>

c:/AutFinanceBank/src/screens/HistoryScreen.js
<DOCUMENT>
// screens/BillsScreen.js
import React from 'react';
import { View, Text } from 'react-native';

const BillsScreen = () => (
  <View style={{ flex: 1, justifyContent: 'center', alignItems: 'center' }}>
    <Text>history Screen</Text>
  </View>
);

export default BillsScreen;
</DOCUMENT>

c:/AutFinanceBank/src/screens/HomeScreen.js
<DOCUMENT>
import React, { useContext, useEffect, useState, useRef } from 'react';
import {
  View,
  Text,
  StyleSheet,
  ScrollView,
  SafeAreaView,
  TouchableOpacity,
  FlatList,
  Dimensions,
  ActivityIndicator,
  RefreshControl,
  Animated,
  Image,
} from 'react-native';
import Icon from 'react-native-vector-icons/MaterialIcons';
import { useNavigation, useRoute } from '@react-navigation/native';
import { useQuery } from 'react-query';
import { AuthContext } from '../context/AuthContext';
import { getUserDetails, getUserTransactions } from '../services/userService';
import initializeWebSocket from '../services/socket';
import { homeScreenTheme } from '../styles/homeScreenTheme';
import * as recipientStorage from '../services/recipientStorage';

const { height } = Dimensions.get('window');

const HomeScreen = () => {
  const navigation = useNavigation();
  const route = useRoute();
  const { user } = useContext(AuthContext);
  const [balance, setBalance] = useState(null);
  const [ws, setWs] = useState(null);
  const [recipients, setRecipients] = useState([]);
  const [recipientsLoading, setRecipientsLoading] = useState(true);
  const [recipientsError, setRecipientsError] = useState(null);
  const opacityAnim = useRef(new Animated.Value(1)).current;
  const scaleAnim = useRef(new Animated.Value(1)).current;

  console.log('HomeScreen route.params:', route.params);
  console.log('HomeScreen user:', user);
  console.log('HomeScreen user keys:', user ? Object.keys(user) : 'undefined');
  console.log('HomeScreen: recipientStorage module:', recipientStorage);

  const { data: userData, isLoading: userLoading, error: userError, refetch: refetchUser } = useQuery(
    ['user', user?.UserID],
    async () => {
      if (!user?.access_token) {
        throw new Error('No access token available');
      }
      const data = await getUserDetails();
      console.log('HomeScreen: getUserDetails response:', data);
      return data;
    },
    {
      enabled: !!user?.access_token,
      retry: false,
      onSuccess: (data) => {
        animateBalance();
        setBalance(data.Balance);
      },
    }
  );

  const { data: transactionsResponse, isLoading: transactionsLoading, error: transactionsError, refetch: refetchTransactions } = useQuery(
    ['transactions', user?.UserID],
    async () => {
      if (!user?.access_token) {
        throw new Error('No access token available');
      }
      const response = await getUserTransactions({ per_page: 10, sort_by: 'Timestamp', order: 'desc' });
      console.log('HomeScreen: getUserTransactions response:', response);
      return response.data.items; // Access items directly
    },
    {
      enabled: !!user?.access_token,
      retry: false,
    }
  );

  const animateBalance = () => {
    console.log('HomeScreen: Triggering balance animation');
    Animated.parallel([
      Animated.sequence([
        Animated.timing(opacityAnim, {
          toValue: 0.5,
          duration: 150,
          useNativeDriver: true,
        }),
        Animated.timing(opacityAnim, {
          toValue: 1,
          duration: 150,
          useNativeDriver: true,
        }),
      ]),
      Animated.sequence([
        Animated.timing(scaleAnim, {
          toValue: 1.05,
          duration: 150,
          useNativeDriver: true,
        }),
        Animated.timing(scaleAnim, {
          toValue: 1,
          duration: 150,
          useNativeDriver: true,
        }),
      ]),
    ]).start();
  };

  useEffect(() => {
    let webSocket;
    const setupWebSocket = async () => {
      webSocket = await initializeWebSocket(user?.access_token);
      if (webSocket) {
        setWs(webSocket);
        webSocket.onmessage = (event) => {
          try {
            const message = JSON.parse(event.data);
            console.log('HomeScreen: WebSocket message:', JSON.stringify(message, null, 2));
            if (message.type === 'balance_update' && message.data?.Balance != null) {
              console.log('HomeScreen: Updating balance from balance_update:', message.data.Balance);
              animateBalance();
              setBalance(message.data.Balance);
            }
            if (message.type === 'deposit_completed' && message.data?.balance != null) {
              console.log('HomeScreen: Updating balance from deposit_completed:', message.data.balance);
              animateBalance();
              setBalance(message.data.balance);
            }
          } catch (error) {
            console.error('HomeScreen: WebSocket message parse error:', error, 'Raw data:', event.data);
          }
        };
      }
    };

    if (user?.access_token) {
      setupWebSocket();
    }

    return () => {
      if (webSocket) {
        webSocket.close();
        console.log('HomeScreen: WebSocket closed');
      }
    };
  }, [user?.access_token]);

   
  
    const id = user?.UserID;
    if (id) {
      console.log("UserID:", id);
      recipientStorage.saveMockRecipients(id);
    } else {
      console.error("Failed to get UserID from getUserDetails response.");
    }
    

  useEffect(() => {
    const loadRecipients = async () => {
      console.log('HomeScreen: Loading recipients for UserID:', user.UserID);
      if (!recipientStorage.setUserId || !recipientStorage.getRecipients) {
        console.error('HomeScreen: recipientStorage module is invalid');
        setRecipientsLoading(false);
        setRecipientsError('Failed to load recipient storage module');
        return;
      }

      try {
        setRecipientsLoading(true);
        setRecipientsError(null);
        await recipientStorage.setUserId(user.UserID);
        const loadedRecipients = await recipientStorage.getRecipients(user.UserID);
        setRecipients(loadedRecipients);
        console.log('HomeScreen: Loaded', loadedRecipients.length, 'recipients');
      } catch (error) {
        console.error('HomeScreen: Error loading recipients:', error.message);
        setRecipientsError(error.message || 'Failed to load recipients');
      } finally {
        setRecipientsLoading(false);
      }
    };
    loadRecipients();
  }, [user.UserID]);

  const onRefresh = async () => {
    if (user?.access_token) {
      await Promise.all([refetchUser(), refetchTransactions()]);
      if (user?.UserID && recipientStorage.getRecipients) {
        console.log('HomeScreen: Refreshing recipients for UserID:', user.UserID);
        try {
          const loadedRecipients = await recipientStorage.getRecipients(user.UserID);
          setRecipients(loadedRecipients);
        } catch (error) {
          setRecipientsError(error.message || 'Failed to refresh recipients');
        }
      }
    }
  };

  const BalanceCard = () => {
    console.log('BalanceCard: Rendering with balance:', balance);
    return (
      <View style={styles.balanceCard}>
        <Text style={styles.balanceTitle}>Balance</Text>
        <View style={styles.balanceRow}>
          <Animated.Text
            style={[
              styles.balanceAmount,
              {
                opacity: opacityAnim,
                transform: [{ scale: scaleAnim }],
              },
            ]}
          >
            {balance != null ? `$${balance.toFixed(2)}` : '...'}
          </Animated.Text>
          <TouchableOpacity onPress={() => navigation.navigate('QRCode')}>
            <Icon name="qr-code" size={24} color={homeScreenTheme.primary} />
          </TouchableOpacity>
        </View>
      </View>
    );
  };

  const ServiceItem = ({ title, icon, screen }) => (
    <TouchableOpacity style={styles.serviceItem} onPress={() => navigation.navigate(screen)}>
      <Icon name={icon} size={24} color={homeScreenTheme.primary} />
      <Text style={styles.serviceText}>{title}</Text>
    </TouchableOpacity>
  );

  const TransactionItem = ({ item }) => {
    const isDeposit = !!item.DepositID;
    const type = isDeposit ? 'credit' : 'debit';
    const transactionId = item.DepositID || item.TransferID;
    
    console.log('HomeScreen: Rendering transaction:', { transactionId, type, Description: item.Description, Amount: item.Amount });

    return (
      <View style={styles.transaction}>
        <Text style={[styles.transactionIcon, { color: type === 'credit' ? homeScreenTheme.credit : homeScreenTheme.debit }]}>
          {type === 'credit' ? '‚Üì' : '‚Üë'}
        </Text>
        <View style={styles.transactionDetails}>
          <Text style={styles.transactionDescription}>{item.Description || (isDeposit ? 'Deposit' : 'Transfer')}</Text>
          <Text style={styles.transactionDate}>
            {new Date(item.Timestamp).toLocaleString()}
          </Text>
        </View>
        <Text style={[styles.transactionAmount, { color: type === 'credit' ? homeScreenTheme.credit : homeScreenTheme.debit }]}>
          {type === 'credit' ? '+' : '-'}${item.Amount.toFixed(2)}
        </Text>
      </View>
    );
  };

  const RecipientItem = ({ item }) => (
    <TouchableOpacity
      style={styles.recipientItem}
      onPress={() => {
        console.log('HomeScreen: Selected recipient:', item);
      }}
    >
      <View style={styles.recipientAvatar}>
        {item.image ? (
          <Image
            source={{ uri: item.image }}
            style={styles.recipientImage}
            onError={(e) => {
              console.error('HomeScreen: Failed to load recipient image:', item.image, e.nativeEvent.error);
            }}
          />
        ) : (
          <Text style={styles.recipientAvatarText}>{item.name?.[0]?.toUpperCase() || 'R'}</Text>
        )}
      </View>
      <Text style={styles.recipientName} numberOfLines={1}>
        {item.name || 'Unknown'}
      </Text>
      <Text style={styles.recipientUsername} numberOfLines={1}>
        @{item.username || 'N/A'}
      </Text>
    </TouchableOpacity>
  );

  if (!user) {
    return (
      <SafeAreaView style={styles.container}>
        <View style={styles.blueSection}>
          <Text style={styles.username}>Please log in to continue</Text>
          <TouchableOpacity
            style={styles.retryButton}
            onPress={() => navigation.reset({ index: 0, routes: [{ name: 'Login' }] })}
          >
            <Text style={styles.retryButtonText}>Go to Login</Text>
          </TouchableOpacity>
        </View>
      </SafeAreaView>
    );
  }

  if (userLoading && balance == null) {
    return (
      <SafeAreaView style={styles.container}>
        <ActivityIndicator size="large" color={homeScreenTheme.primary} style={{ flex: 1 }} />
      </SafeAreaView>
    );
  }

  if (userError) {
    return (
      <SafeAreaView style={styles.container}>
        <View style={styles.blueSection}>
          <Text style={styles.username}>Error loading data</Text>
          <Text style={styles.errorText}>{userError.message || 'Failed to load data'}</Text>
          <TouchableOpacity
            style={styles.retryButton}
            onPress={() => refetchUser()}
          >
            <Text style={styles.retryButtonText}>Retry</Text>
          </TouchableOpacity>
          <TouchableOpacity
            style={styles.retryButton}
            onPress={() => navigation.reset({ index: 0, routes: [{ name: 'Login' }] })}
          >
            <Text style={styles.retryButtonText}>Back to Login</Text>
          </TouchableOpacity>
        </View>
      </SafeAreaView>
    );
  }

  return (
    <SafeAreaView style={styles.container}>
      <ScrollView
        contentContainerStyle={styles.scrollContent}
        refreshControl={<RefreshControl refreshing={userLoading || transactionsLoading} onRefresh={onRefresh} />}
      >
        <View style={styles.blueSection}>
          <View style={styles.header}>
            <View style={styles.userContainer}>
              <View style={styles.userAvatar}>
                <Text style={styles.avatarText}>{userData?.FirstName?.[0]?.toUpperCase() || 'U'}</Text>
              </View>
              <View style={styles.userTextContainer}>
                <Text style={styles.username}>{userData?.FirstName || 'User'}</Text>
                <Text style={styles.greeting}>Let's save your money</Text>
              </View>
            </View>
            <TouchableOpacity onPress={() => navigation.navigate('Notifications')}>
              <Icon name="notifications" size={24} color={homeScreenTheme.notificationIcon} />
            </TouchableOpacity>
          </View>
          <BalanceCard />
        </View>

        <View style={styles.whiteSection}>
          <View style={styles.servicesContainer}>
            <Text style={styles.sectionTitle}>Services</Text>
            <View style={styles.servicesRow}>
              <ServiceItem title="Send" icon="send" screen="Send" />
              <ServiceItem title="Deposit" icon="add" screen="Deposit" />
              <ServiceItem title="Loan" icon="account-balance" screen="Loan" />
            </View>
            <View style={styles.servicesRow}>
              <ServiceItem title="Withdraw" icon="atm" screen="Withdraw" />
              <ServiceItem title="Cards" icon="credit-card" screen="Cards" />
              <ServiceItem title="Transactions" icon="history" screen="Transactions" />
            </View>
          </View>

          <View style={styles.recipientsContainer}>
            <View style={styles.sectionHeader}>
              <Text style={styles.sectionTitle}>Recipients</Text>
              <TouchableOpacity onPress={() => navigation.navigate('RecipientScreen')}>
                <Text style={styles.seeAllText}>See All</Text>
              </TouchableOpacity>
            </View>
            {recipientsLoading ? (
              <ActivityIndicator size="small" color={homeScreenTheme.primary} />
            ) : recipientsError ? (
              <View>
                <Text style={styles.errorText}>{recipientsError}</Text>
                <TouchableOpacity
                  onPress={async () => {
                    if (!recipientStorage.setUserId || !recipientStorage.getRecipients) {
                      setRecipientsError('Failed to load recipient storage module');
                      return;
                    }
                    if (user?.UserID) {
                      console.log('HomeScreen: Retrying recipients load for UserID:', user.UserID);
                      try {
                        setRecipientsLoading(true);
                        setRecipientsError(null);
                        await recipientStorage.setUserId(user.UserID);
                        const loadedRecipients = await recipientStorage.getRecipients(user.UserID);
                        setRecipients(loadedRecipients);
                      } catch (error) {
                        setRecipientsError(error.message || 'Failed to load recipients');
                      } finally {
                        setRecipientsLoading(false);
                      }
                    } else {
                      setRecipientsError('User not authenticated');
                    }
                  }}
                >
                  <Text style={styles.seeAllText}>Retry</Text>
                </TouchableOpacity>
              </View>
            ) : recipients.length === 0 ? (
              <Text style={styles.transactionDescription}>No recipients available</Text>
            ) : (
              <FlatList
                data={recipients}
                horizontal
                renderItem={RecipientItem}
                keyExtractor={(item) => item.recipientId.toString()}
                showsHorizontalScrollIndicator={false}
              />
            )}
          </View>

          <View style={styles.transactionsContainer}>
            <View style={styles.sectionHeader}>
              <Text style={styles.sectionTitle}>Transaction History</Text>
              <TouchableOpacity onPress={() => navigation.navigate('Transactions')}>
                <Text style={styles.seeAllText}>See All</Text>
              </TouchableOpacity>
            </View>
            {transactionsLoading ? (
              <ActivityIndicator size="small" color={homeScreenTheme.primary} />
            ) : transactionsError ? (
              <View>
                <Text style={styles.transactionDescription}>Failed to load transactions: {transactionsError.message}</Text>
                <TouchableOpacity onPress={() => refetchTransactions()}>
                  <Text style={styles.seeAllText}>Retry</Text>
                </TouchableOpacity>
              </View>
            ) : !transactionsResponse || transactionsResponse.length === 0 ? (
              <Text style={styles.transactionDescription}>No transactions available</Text>
            ) : (
              <FlatList
                data={transactionsResponse}
                renderItem={TransactionItem}
                keyExtractor={(item) => (item.DepositID || item.TransferID).toString()}
                scrollEnabled={false}
              />
            )}
          </View>
        </View>
      </ScrollView>
    </SafeAreaView>
  );
};

const styles = StyleSheet.create({
  container: { flex: 1, backgroundColor: homeScreenTheme.background },
  scrollContent: { flexGrow: 1, backgroundColor: homeScreenTheme.background },
  blueSection: {
    height: height * 0.2,
    backgroundColor: homeScreenTheme.primary,
    borderBottomLeftRadius: 20,
    borderBottomRightRadius: 20,
    padding: 16,
  },
  header: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    alignItems: 'center',
  },
  userContainer: {
    flexDirection: 'row',
    alignItems: 'center',
  },
  userAvatar: {
    width: 40,
    height: 40,
    borderRadius: 20,
    backgroundColor: homeScreenTheme.white,
    justifyContent: 'center',
    alignItems: 'center',
    marginRight: 12,
  },
  avatarText: {
    fontSize: 20,
    fontWeight: 'bold',
    color: homeScreenTheme.black,
  },
  userTextContainer: { flexDirection: 'column' },
  username: { fontSize: 18, fontWeight: 'bold', color: homeScreenTheme.white },
  greeting: { fontSize: 14, color: homeScreenTheme.white, marginTop: 4 },
  balanceCard: {
    backgroundColor: homeScreenTheme.white,
    borderRadius: 12,
    padding: 16,
    elevation: 4,
    position: 'absolute',
    top: height * 0.12,
    left: 16,
    right: 16,
    zIndex: 2,
  },
  balanceTitle: { fontSize: 14, color: homeScreenTheme.secondary },
  balanceRow: {
    flexDirection: 'row',
    alignItems: 'center',
    justifyContent: 'space-between',
  },
  balanceAmount: { fontSize: 26, fontWeight: 'bold', color: homeScreenTheme.black, marginVertical: 4 },
  whiteSection: {
    paddingTop: height * 0.08,
    backgroundColor: homeScreenTheme.background,
  },
  servicesContainer: { paddingHorizontal: 16 },
  sectionTitle: { fontSize: 16, fontWeight: 'bold', color: homeScreenTheme.black, marginBottom: 12 },
  servicesRow: { flexDirection: 'row', justifyContent: 'space-between', marginBottom: 12 },
  serviceItem: {
    flex: 1,
    alignItems: 'center',
    padding: 12,
    backgroundColor: homeScreenTheme.serviceBackground,
    borderRadius: 8,
    marginHorizontal: 4,
  },
  serviceText: { fontSize: 12, color: homeScreenTheme.black, marginTop: 4 },
  recipientsContainer: { padding: 16 },
  sectionHeader: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    alignItems: 'center',
    marginBottom: 12,
  },
  seeAllText: {
    fontSize: 14,
    color: homeScreenTheme.link,
    fontWeight: '500',
  },
  recipientItem: {
    alignItems: 'center',
    marginRight: 16,
    width: 80,
  },
  recipientAvatar: {
    width: 50,
    height: 50,
    borderRadius: 25,
    backgroundColor: homeScreenTheme.serviceBackground,
    justifyContent: 'center',
    alignItems: 'center',
    overflow: 'hidden',
  },
  recipientImage: {
    width: 50,
    height: 50,
    borderRadius: 25,
  },
  recipientAvatarText: {
    fontSize: 20,
    fontWeight: 'bold',
    color: homeScreenTheme.black,
  },
  recipientName: {
    fontSize: 12,
    color: homeScreenTheme.black,
    marginTop: 4,
    textAlign: 'center',
  },
  recipientUsername: {
    fontSize: 10,
    color: homeScreenTheme.secondary,
    textAlign: 'center',
  },
  retryButton: {
    backgroundColor: homeScreenTheme.retryButton,
    padding: 10,
    borderRadius: 5,
    marginTop: 10,
    alignItems: 'center',
  },
  retryButtonText: {
    color: homeScreenTheme.retryButtonText,
    fontSize: 16,
    fontWeight: 'bold',
  },
  errorText: {
    fontSize: 14,
    color: homeScreenTheme.debit,
    marginVertical: 8,
    textAlign: 'center',
  },
  transactionsContainer: { padding: 16 },
  transaction: { flexDirection: 'row', alignItems: 'center', paddingVertical: 8 },
  transactionIcon: { fontSize: 20, marginRight: 8 },
  transactionDetails: { flex: 1 },
  transactionDescription: { fontSize: 14, color: homeScreenTheme.black },
  transactionDate: { fontSize: 10, color: homeScreenTheme.secondary },
  transactionAmount: { fontSize: 14, fontWeight: 'bold' },
});

export default HomeScreen;
</DOCUMENT>

c:/AutFinanceBank/src/screens/LoanScreen.js
<DOCUMENT>
import React, { useState, useContext } from 'react';
import { View, Text, TextInput, TouchableOpacity, FlatList, StyleSheet, Modal } from 'react-native';
import { useQuery, useMutation } from 'react-query';
import { AuthContext } from '../context/AuthContext';
import { applyForLoan, getLoanTypes, getLoans, makeLoanPayment } from '../services/loanService';
import { LoanApplySchema, LoanPaymentCreateSchema } from '../utils/validators';
import { formatCurrency, formatDate } from '../utils/helpers';
import globalStyles from '../styles/globalStyles';

const LoanScreen = () => {
  const { user } = useContext(AuthContext);
  const [showApplyModal, setShowApplyModal] = useState(false);
  const [showPaymentModal, setShowPaymentModal] = useState(false);
  const [loanTypeId, setLoanTypeId] = useState('');
  const [loanAmount, setLoanAmount] = useState('');
  const [loanDuration, setLoanDuration] = useState('');
  const [dueDate, setDueDate] = useState('');
  const [paymentLoanId, setPaymentLoanId] = useState(null);
  const [paymentAmount, setPaymentAmount] = useState('');
  const [errorMessage, setErrorMessage] = useState('');

  const { data: loanTypes, isLoading: typesLoading } = useQuery('loanTypes', getLoanTypes, {
    enabled: !!user,
  });

  const { data: loans, isLoading: loansLoading, refetch } = useQuery('loans', () => getLoans({ page: 1, per_page: 10 }), {
    enabled: !!user,
  });

  const applyMutation = useMutation(applyForLoan, {
    onSuccess: () => {
      setShowApplyModal(false);
      setLoanTypeId('');
      setLoanAmount('');
      setLoanDuration('');
      setDueDate('');
      refetch();
    },
    onError: (error) => setErrorMessage(error.message),
  });

  const paymentMutation = useMutation(makeLoanPayment, {
    onSuccess: () => {
      setShowPaymentModal(false);
      setPaymentLoanId(null);
      setPaymentAmount('');
      refetch();
    },
    onError: (error) => setErrorMessage(error.message),
  });

  const handleApplyLoan = async () => {
    setErrorMessage('');
    try {
      const loanData = {
        LoanTypeID: parseInt(loanTypeId),
        LoanAmount: parseFloat(loanAmount),
        LoanDurationMonths: parseInt(loanDuration),
        DueDate: formatDate(dueDate),
      };
      await LoanApplySchema.validate(loanData);
      applyMutation.mutate(loanData);
    } catch (error) {
      setErrorMessage(error.message);
    }
  };

  const handleMakePayment = async () => {
    setErrorMessage('');
    try {
      const paymentData = {
        LoanID: paymentLoanId,
        PaymentAmount: parseFloat(paymentAmount),
      };
      await LoanPaymentCreateSchema.validate(paymentData);
      paymentMutation.mutate(paymentData);
    } catch (error) {
      setErrorMessage(error.message);
    }
  };

  const renderLoan = ({ item }) => (
    <View style={styles.loan}>
      <Text style={styles.loanText}>Type: {item.LoanTypeName}</Text>
      <Text style={styles.loanText}>Amount: {formatCurrency(item.LoanAmount)}</Text>
      <Text style={styles.loanText}>Status: {item.LoanStatus}</Text>
      <Text style={styles.loanText}>Due: {item.DueDate}</Text>
      <TouchableOpacity
        style={styles.actionButton}
        onPress={() => {
          setPaymentLoanId(item.LoanID);
          setShowPaymentModal(true);
        }}
      >
        <Text style={styles.actionText}>Make Payment</Text>
      </TouchableOpacity>
    </View>
  );

  if (!user) {
    return (
      <View style={globalStyles.container}>
        <Text>Please log in to manage loans</Text>
      </View>
    );
  }

  return (
    <View style={globalStyles.container}>
      <Text style={[globalStyles.textXLargeBlack, { marginBottom: globalStyles.SPACING.large }]}>
        Loans
      </Text>
      {loansLoading ? (
        <Text>Loading loans...</Text>
      ) : (
        <FlatList
          data={loans?.data || []}
          renderItem={renderLoan}
          keyExtractor={(item) => item.LoanID.toString()}
        />
      )}
      <TouchableOpacity
        style={globalStyles.button}
        onPress={() => setShowApplyModal(true)}
      >
        <Text style={globalStyles.buttonText}>Apply for Loan</Text>
      </TouchableOpacity>
      {errorMessage ? <Text style={globalStyles.textError}>{errorMessage}</Text> : null}

      <Modal visible={showApplyModal} animationType="slide">
        <View style={globalStyles.container}>
          <Text style={[globalStyles.textXLargeBlack, { marginBottom: globalStyles.SPACING.large }]}>
            Apply for Loan
          </Text>
          <TextInput
            style={globalStyles.input}
            placeholder="Loan Type ID"
            keyboardType="numeric"
            value={loanTypeId}
            onChangeText={setLoanTypeId}
          />
          <TextInput
            style={globalStyles.input}
            placeholder="Loan Amount"
            keyboardType="numeric"
            value={loanAmount}
            onChangeText={setLoanAmount}
          />
          <TextInput
            style={globalStyles.input}
            placeholder="Duration (Months)"
            keyboardType="numeric"
            value={loanDuration}
            onChangeText={setLoanDuration}
          />
          <TextInput
            style={globalStyles.input}
            placeholder="Due Date (YYYY-MM-DD)"
            value={dueDate}
            onChangeText={setDueDate}
          />
          {errorMessage ? <Text style={globalStyles.textError}>{errorMessage}</Text> : null}
          <TouchableOpacity
            style={[globalStyles.button, applyMutation.isLoading && { opacity: 0.7 }]}
            onPress={handleApplyLoan}
            disabled={applyMutation.isLoading}
          >
            <Text style={globalStyles.buttonText}>
              {applyMutation.isLoading ? 'Applying...' : 'Apply'}
            </Text>
          </TouchableOpacity>
          <TouchableOpacity
            style={globalStyles.buttonOutline}
            onPress={() => setShowApplyModal(false)}
          >
            <Text style={globalStyles.buttonOutlineText}>Cancel</Text>
          </TouchableOpacity>
        </View>
      </Modal>

      <Modal visible={showPaymentModal} animationType="slide">
        <View style={globalStyles.container}>
          <Text style={[globalStyles.textXLargeBlack, { marginBottom: globalStyles.SPACING.large }]}>
            Make Loan Payment
          </Text>
          <TextInput
            style={globalStyles.input}
            placeholder="Payment Amount"
            keyboardType="numeric"
            value={paymentAmount}
            onChangeText={setPaymentAmount}
          />
          {errorMessage ? <Text style={globalStyles.textError}>{errorMessage}</Text> : null}
          <TouchableOpacity
            style={[globalStyles.button, paymentMutation.isLoading && { opacity: 0.7 }]}
            onPress={handleMakePayment}
            disabled={paymentMutation.isLoading}
          >
            <Text style={globalStyles.buttonText}>
              {paymentMutation.isLoading ? 'Processing...' : 'Pay'}
            </Text>
          </TouchableOpacity>
          <TouchableOpacity
            style={globalStyles.buttonOutline}
            onPress={() => setShowPaymentModal(false)}
          >
            <Text style={globalStyles.buttonOutlineText}>Cancel</Text>
          </TouchableOpacity>
        </View>
      </Modal>
    </View>
  );
};

const styles = StyleSheet.create({
  loan: {
    backgroundColor: globalStyles.COLORS.gray,
    borderRadius: 8,
    padding: 16,
    marginVertical: 8,
  },
  loanText: {
    fontSize: globalStyles.FONT_SIZES.medium,
    color: globalStyles.COLORS.text,
  },
  actionButton: {
    backgroundColor: globalStyles.COLORS.primary,
    padding: 8,
    borderRadius: 5,
    marginTop: 8,
    alignItems: 'center',
  },
  actionText: {
    color: globalStyles.COLORS.white,
    fontSize: globalStyles.FONT_SIZES.small,
  },
});

export default LoanScreen;
</DOCUMENT>

c:/AutFinanceBank/src/screens/LoginScreen.js
<DOCUMENT>
import React, { useState, useContext } from 'react';
import { View, Text, TextInput, TouchableOpacity, KeyboardAvoidingView, ScrollView, Platform, StyleSheet } from 'react-native';
import Icon from 'react-native-vector-icons/MaterialIcons';
import { AuthContext } from '../context/AuthContext';
import { UserLoginSchema } from '../utils/validators';
import globalStyles from '../styles/globalStyles';
import initializeWebSocket from '../services/socket';

const LoginScreen = ({ navigation }) => {
  const { login } = useContext(AuthContext);
  const [loginId, setLoginId] = useState('');
  const [password, setPassword] = useState('');
  const [showPassword, setShowPassword] = useState(false);
  const [errorMessage, setErrorMessage] = useState('');
  const [isLoading, setIsLoading] = useState(false);

  const handleLogin = async () => {
    setErrorMessage('');
    setIsLoading(true);
    try {
      // Validate input
      await UserLoginSchema.validate({ login_id: loginId, Password: password });
      console.log('LoginScreen: Sending login request:', { login_id: loginId, Password: password });

      // Call login from AuthContext
      const result = await login(loginId, password);
      if (result.success) {
        console.log('LoginScreen: Login successful');
        // Initialize WebSocket
        const ws = await initializeWebSocket();
        if (ws) {
          console.log('LoginScreen: WebSocket initialized');
        } else {
          console.warn('LoginScreen: Failed to initialize WebSocket');
        }
        // Navigate to Home
        navigation.replace('Home');
      } else {
        console.log('LoginScreen: Login failed:', result.message);
        setErrorMessage(result.message);
      }
    } catch (error) {
      console.error('LoginScreen: Error:', error.response?.data || error.message);
      const errorMsg = error.response?.data?.detail || error.message || 'Login failed. Please try again.';
      setErrorMessage(errorMsg);
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <KeyboardAvoidingView
      style={{ flex: 1 }}
      behavior={Platform.OS === 'ios' ? 'padding' : 'height'}
      keyboardVerticalOffset={Platform.OS === 'ios' ? 0 : 20}
    >
      <ScrollView contentContainerStyle={{ flexGrow: 1 }}>
        <View style={[globalStyles.container, { justifyContent: 'space-between' }]}>
          <View>
            <View style={[globalStyles.logoContainer, { marginLeft: globalStyles.SPACING.medium, marginTop: globalStyles.SPACING.large }]}>
              <View style={[globalStyles.circle, globalStyles.circlePrimary]} />
              <View style={[globalStyles.circle, globalStyles.circleSecondary]} />
            </View>
            <Text style={[globalStyles.textXLargeBlack, { marginBottom: globalStyles.SPACING.large, alignSelf: 'center' }]}>
              Login
            </Text>
            <TextInput
              style={[globalStyles.input, { color: globalStyles.COLORS.text }]}
              placeholder="Email or Username"
              placeholderTextColor={globalStyles.COLORS.placeholder}
              value={loginId}
              onChangeText={setLoginId}
              autoCapitalize="none"
              editable={!isLoading}
            />
            <View style={{ position: 'relative', width: '100%', alignSelf: 'center' }}>
              <TextInput
                style={[globalStyles.input, { color: globalStyles.COLORS.text }]}
                placeholder="Password"
                placeholderTextColor={globalStyles.COLORS.placeholder}
                secureTextEntry={!showPassword}
                value={password}
                onChangeText={setPassword}
                editable={!isLoading}
              />
              <TouchableOpacity
                style={styles.eyeIcon}
                onPress={() => setShowPassword(!showPassword)}
              >
                <Icon name={showPassword ? 'visibility' : 'visibility-off'} size={20} color={globalStyles.COLORS.text} />
              </TouchableOpacity>
            </View>
            {errorMessage ? <Text style={[globalStyles.textError, { alignSelf: 'center' }]}>{errorMessage}</Text> : null}
            <TouchableOpacity
              style={[globalStyles.button, isLoading && { opacity: 0.7 }, { alignSelf: 'center' }]}
              onPress={handleLogin}
              disabled={isLoading}
            >
              <Text style={globalStyles.buttonText}>{isLoading ? 'Logging in...' : 'Login'}</Text>
            </TouchableOpacity>
            <TouchableOpacity onPress={() => navigation.navigate('ForgotPassword')}>
              <Text style={[globalStyles.text, styles.forgotPasswordLink]}>Forgot Password?</Text>
            </TouchableOpacity>
            <TouchableOpacity onPress={() => navigation.navigate('SignupStep1')}>
              <Text style={[globalStyles.text, styles.signUpLink]}>Don't have an account? Create one</Text>
            </TouchableOpacity>
          </View>
          <View style={styles.footer}>
            <View style={styles.footerLine} />
            <Text style={styles.footerText}>Your Trusted Banking Partner</Text>
            <View style={styles.footerLine} />
          </View>
        </View>
      </ScrollView>
    </KeyboardAvoidingView>
  );
};

const styles = StyleSheet.create({
  eyeIcon: {
    position: 'absolute',
    right: 10,
    top: '50%',
    transform: [{ translateY: -12 }],
    justifyContent: 'center',
    alignItems: 'center',
    padding: 5,
  },
  forgotPasswordLink: {
    color: globalStyles.COLORS.primary,
    textAlign: 'center',
    marginVertical: globalStyles.SPACING.small,
    textDecorationLine: 'underline',
    alignSelf: 'center',
  },
  signUpLink: {
    color: globalStyles.COLORS.secondary,
    textAlign: 'center',
    marginVertical: globalStyles.SPACING.small,
    textDecorationLine: 'underline',
    alignSelf: 'center',
  },
  footer: {
    alignItems: 'center',
    marginBottom: globalStyles.SPACING.large,
  },
  footerLine: {
    width: '80%',
    height: 2,
    backgroundColor: globalStyles.COLORS.primary,
    marginVertical: globalStyles.SPACING.small,
  },
  footerText: {
    fontSize: 16,
    color: globalStyles.COLORS.text,
    fontStyle: 'italic',
  },
});

export default LoginScreen;
</DOCUMENT>

c:/AutFinanceBank/src/screens/NotificationsScreen.js
<DOCUMENT>
import React from 'react';
import { View, Text } from 'react-native';

const NotificationsScreen = () => (
  <View style={{ flex: 1, justifyContent: 'center', alignItems: 'center' }}>
    <Text>Notifications Screen</Text>
  </View>
);

export default NotificationsScreen;
</DOCUMENT>

c:/AutFinanceBank/src/screens/OnboardingScreen.js
<DOCUMENT>
import React, { useRef, useState } from 'react';
import { View, Text, FlatList, TouchableOpacity, Dimensions, SafeAreaView } from 'react-native';
import globalStyles from '../styles/globalStyles'; // Adjust the path as needed
import { useNavigation } from '@react-navigation/native';

const { width } = Dimensions.get('screen');

const onboardingData = [
  {
    id: '1',
    logo: true, // Use the two-circle logo
    title1: 'Welcome to',
    title2: 'Aut Bank.',
    subtitle: 'Your Best Money Transfer Partner.',
    showGetStarted: true,
  },
  {
    id: '2',
    logo: true, // Use the two-circle logo (same as first screen)
    title1: 'Easy, Fast & Trusted',
    subtitle: 'Fast money transfer and guaranteed safe with others.',
    showGetStarted: false,
    logoText: 'Fast', // Bold text below the logo
  },
  {
    id: '3',
    logo: true, // Use the two-circle logo (same as first screen)
    title1: 'Free Transactions',
    subtitle: 'Provides the quality of the financial system with free money transactions without any fees.',
    showGetStarted: false,
    logoText: 'Free', // Bold text below the logo
  },
];

const OnboardingScreen = () => {
  const navigation = useNavigation();
  const flatListRef = useRef(null);
  const [currentIndex, setCurrentIndex] = useState(0);

  const handleContinue = () => {
    if (currentIndex < onboardingData.length - 1) {
      const nextIndex = currentIndex + 1;
      flatListRef.current.scrollToIndex({ index: nextIndex, animated: true });
      setCurrentIndex(nextIndex);
    }
  };

  const handleLogin = () => {
    navigation.navigate('Login');
    
    // navigation.navigate('Home');

  };

  const handleSignup = () => {
    navigation.navigate('SignupStep1');
  };

  const renderItem = ({ item, index }) => (
    <View style={{ width, flex: 1 }}>
      {/* Centered content (logo, title, subtitle) */}
      <View style={[globalStyles.centeredContainer, { flex: 1 }]}>
        {/* Logo with bold text below */}
        {item.logo && (
          <View style={{ alignItems: 'center' }}>
            <View style={globalStyles.logoContainer}>
              <View style={[globalStyles.circle, globalStyles.circlePrimary]} />
              <View style={[globalStyles.circle, globalStyles.circleSecondary]} />
            </View>
            {/* Bold text below the logo for screens 2 and 3 */}
            {item.logoText && (
              <Text
                style={{
                  fontSize: globalStyles.FONT_SIZES.xlarge,
                  fontWeight: 'bold',
                  color: globalStyles.COLORS.primary,
                  marginBottom: globalStyles.SPACING.medium,
                }}
              >
                {item.logoText}
              </Text>
            )}
          </View>
        )}

        {/* Title */}
        <Text style={globalStyles.textXLargeBlack}>{item.title1}</Text>
        {item.title2 && <Text style={globalStyles.textXLarge}>{item.title2}</Text>}

        {/* Subtitle */}
        <Text
          style={[
            item.id === '1' ? globalStyles.textSmall : globalStyles.textSmallGray,
            { marginTop: globalStyles.SPACING.medium },
          ]}
        >
          {item.subtitle}
        </Text>
      </View>

      {/* Bottom container for buttons and dots */}
      <View
        style={{
          position: 'absolute',
          bottom: globalStyles.SPACING.xlarge,
          width: '100%',
          alignItems: 'center',
        }}
      >
        {/* Buttons */}
        {index === onboardingData.length - 1 ? (
          // Show Login and Signup buttons on the last screen
          <View>
            <TouchableOpacity style={globalStyles.button} onPress={handleLogin}>
              <Text style={globalStyles.buttonText}>Login</Text>
            </TouchableOpacity>
            <TouchableOpacity style={globalStyles.buttonOutline} onPress={handleSignup}>
              <Text style={globalStyles.buttonOutlineText}>Signup</Text>
            </TouchableOpacity>
          </View>
        ) : (
          // Show Get Started or Continue button
          <TouchableOpacity
            style={globalStyles.button}
            onPress={item.showGetStarted ? handleContinue : handleContinue}
          >
            <Text style={globalStyles.buttonText}>
              {item.showGetStarted ? 'Get Started' : 'Continue'}
            </Text>
          </TouchableOpacity>
        )}

        {/* Dots */}
        <View style={globalStyles.dotContainer}>
          {onboardingData.map((_, dotIndex) => (
            <View
              key={dotIndex}
              style={[
                globalStyles.dot,
                dotIndex === 0 && currentIndex === 0
                  ? globalStyles.dotFirst
                  : dotIndex === currentIndex
                  ? globalStyles.dotActive
                  : globalStyles.dotInactive,
              ]}
            />
          ))}
        </View>
      </View>
    </View>
  );

  return (
    <SafeAreaView style={globalStyles.container}>
      <FlatList
        ref={flatListRef}
        data={onboardingData}
        renderItem={renderItem}
        keyExtractor={(item) => item.id}
        horizontal
        pagingEnabled
        snapToInterval={width}
        snapToAlignment="center"
        decelerationRate="fast"
        showsHorizontalScrollIndicator={false}
        contentContainerStyle={{ height: '100%' }}
        onMomentumScrollEnd={(event) => {
          const newIndex = Math.round(event.nativeEvent.contentOffset.x / width);
          setCurrentIndex(newIndex);
        }}
      />
    </SafeAreaView>
  );
};

export default OnboardingScreen;
</DOCUMENT>

c:/AutFinanceBank/src/screens/ProfileScreen.js
<DOCUMENT>
import React from 'react';
import { View, Text } from 'react-native';

const ProfileScreen = () => (
  <View style={{ flex: 1, justifyContent: 'center', alignItems: 'center' }}>
    <Text>Profile Screen</Text>
  </View>
);

export default ProfileScreen;
</DOCUMENT>

c:/AutFinanceBank/src/screens/QRCodeScreen.js
<DOCUMENT>
import React from 'react';
import { View, Text } from 'react-native';

const QRCodeScreen = () => (
  <View style={{ flex: 1, justifyContent: 'center', alignItems: 'center' }}>
    <Text>QR Code Screen</Text>
  </View>
);

export default QRCodeScreen;
</DOCUMENT>

c:/AutFinanceBank/src/screens/RecipientScreen.js
<DOCUMENT>
import React, { useEffect, useState, useCallback, useMemo } from 'react';
import { View, Text, FlatList, StyleSheet, Image, TouchableOpacity, TextInput } from 'react-native';
import AsyncStorage from '@react-native-async-storage/async-storage';
import Icon from 'react-native-vector-icons/MaterialIcons';
import * as recipientStorage from '../services/recipientStorage';
import globalStyles from '../styles/globalStyles';
import {getUserDetails} from '../services/userService'
const { COLORS } = globalStyles;

const RecipientScreen = ({ navigation }) => {
  const [recipients, setRecipients] = useState([]);
  const [recipientsLoading, setRecipientsLoading] = useState(false);
  const [recipientsError, setRecipientsError] = useState(null);
  const [searchQuery, setSearchQuery] = useState('');
  const [sortByNameAsc, setSortByNameAsc] = useState(true); // true for ascending, false for descending

  useEffect(() => {
    const loadRecipients = async () => {
      console.log('RecipientScreen: Loading recipients for UserID:', 6);
      if (!recipientStorage.setUserId || !recipientStorage.getRecipients) {
        console.error('RecipientScreen: recipientStorage module is invalid');
        setRecipientsLoading(false);
        setRecipientsError('Failed to load recipient storage module');
        return;
      }

      try {
        setRecipientsLoading(true);
        setRecipientsError(null);
        await recipientStorage.setUserId(6);
        const loadedRecipients = await recipientStorage.getRecipients(6);
        setRecipients(loadedRecipients);
        console.log('RecipientScreen: Loaded', loadedRecipients.length, 'recipients');

        const data = await AsyncStorage.getItem('@recipients:6');
        console.log('RecipientScreen: Verified stored data:', data ? JSON.parse(data).length : 0, 'recipients');
      } catch (error) {
        console.error('RecipientScreen: Error loading recipients:', error.message);
        setRecipientsError(error.message || 'Failed to load recipients');
      } finally {
        setRecipientsLoading(false);
      }
    };
    loadRecipients();
  }, []);

  // Filter and sort recipients based on search query and sort order
  const filteredRecipients = useMemo(() => {
    let result = [...recipients];

    // Filter by search query
    if (searchQuery) {
      result = result.filter((item) =>
        item.name.toLowerCase().includes(searchQuery.toLowerCase())
      );
    }

    // Sort by name
    result.sort((a, b) => {
      const nameA = a.name.toLowerCase();
      const nameB = b.name.toLowerCase();
      if (sortByNameAsc) {
        return nameA < nameB ? -1 : nameA > nameB ? 1 : 0;
      } else {
        return nameA > nameB ? -1 : nameA < nameB ? 1 : 0;
      }
    });

    return result;
  }, [recipients, searchQuery, sortByNameAsc]);

  const response = typeof getUserDetails === 'function' ? getUserDetails() : getUserDetails;

  const id = response?.data?.UserID;
  if (id) {
    console.log("UserID:", id);
    recipientStorage.saveMockRecipients(id);
  } else {
    console.error("Failed to get UserID from getUserDetails response.");
  }
  

  const renderRecipient = useCallback(
    ({ item }) => {
      return (
        <TouchableOpacity
          style={styles.recipientItem}
          onPress={() => navigation.navigate('SendScreen', { recipient: item })}
        >
          <Image
            source={{ uri: item.image }}
            style={styles.recipientImage}
            onError={(error) => console.error(`RecipientScreen: Error loading image for ${item.name}:`, error.nativeEvent.error)}
          />
          <View style={styles.recipientTextContainer}>
            <Text style={styles.recipientText}>{item.name}</Text>
            <Text style={styles.recipientSubText}>{item.email || item.cnic || 'No contact info'}</Text>
          </View>
          <Icon name="send" size={24} color={COLORS.secondary} style={styles.navIcon} />
        </TouchableOpacity>
      );
    },
    [navigation]
  );

  const renderSeparator = () => <View style={styles.separator} />;

  const handleFilterPress = () => {
    setSortByNameAsc((prev) => !prev);
    console.log('Filter icon pressed, sorting:', sortByNameAsc ? 'Descending' : 'Ascending');
  };

  return (
    <View style={styles.container}>
      {/* Send Money Section */}
      {/* <View style={styles.sendMoneyContainer}>
        <Text style={styles.sendMoneyHeading}>Send Money Now</Text>
        <Text style={styles.sendMoneySubtext}>Money Transfer to your Favourites</Text>
        <TouchableOpacity
          style={styles.sendButton}
          onPress={() => navigation.navigate('SendScreen')}
        >
          <Text style={styles.sendButtonText}>SEND NOW</Text>
        </TouchableOpacity>
      </View> */}

      {/* Find Favourites Section */}
      <Text style={styles.findFavouritesHeading}>Find your Favourites</Text>
      <View style={styles.searchBarContainer}>
        <Icon name="search" size={24} color={COLORS.placeholder} style={styles.searchIcon} />
        <TextInput
          style={styles.searchInput}
          placeholder="Find Favourites"
          placeholderTextColor={COLORS.placeholder}
          value={searchQuery}
          onChangeText={(text) => setSearchQuery(text)}
        />
        <TouchableOpacity
          style={styles.filterIconContainer}
          onPress={handleFilterPress}
        >
          <Icon
            name="sort-by-alpha"
            size={24}
            color={COLORS.text}
            style={{ transform: [{ rotate: sortByNameAsc ? '0deg' : '180deg' }] }} // Rotate icon to indicate sort direction
          />
        </TouchableOpacity>
      </View>

      {/* Recipients List */}
      {recipientsLoading && <Text style={styles.loadingText}>Loading recipients...</Text>}
      {recipientsError && <Text style={styles.errorText}>Error: {recipientsError}</Text>}
      {filteredRecipients.length > 0 ? (
        <FlatList
          data={filteredRecipients}
          renderItem={renderRecipient}
          keyExtractor={(item) => `recipient-${item.recipientId}`}
          style={styles.list}
          ItemSeparatorComponent={renderSeparator}
          initialNumToRender={15}
          maxToRenderPerBatch={15}
          getItemLayout={(data, index) => ({
            length: 70,
            offset: 70 * index,
            index,
          })}
        />
      ) : (
        !recipientsLoading && !recipientsError && <Text style={styles.noRecipientsText}>No recipients found.</Text>
      )}

      {/* Debug Button */}
      <TouchableOpacity
        style={styles.verifyButton}
        onPress={async () => {
          const data = await AsyncStorage.getItem('@recipients:6');
          console.log('RecipientScreen: Manual verification:', data ? JSON.parse(data).length : 0, 'recipients');
        }}
      >
        <Text style={styles.verifyButtonText}>Verify Storage</Text>
      </TouchableOpacity>
    </View>
  );
};

const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: COLORS.background,
    paddingHorizontal: 16,
    paddingTop: 20,
  },
  sendMoneyContainer: {
    marginBottom: 20,
  },
  sendMoneyHeading: {
    fontSize: 20,
    fontWeight: '600',
    color: COLORS.text,
    marginBottom: 8,
  },
  sendMoneySubtext: {
    fontSize: 16,
    color: COLORS.placeholder,
    marginBottom: 20,
  },
  sendButton: {
    backgroundColor: COLORS.primary,
    paddingVertical: 12,
    marginHorizontal: '5%',
    borderRadius: 25,
    alignItems: 'center',
    elevation: 5,
    shadowColor: COLORS.black,
    shadowOffset: { width: 0, height: 2 },
    shadowOpacity: 0.2,
    shadowRadius: 4,
  },
  sendButtonText: {
    fontSize: 16,
    fontWeight: 'bold',
    color: COLORS.white,
  },
  findFavouritesHeading: {
    fontSize: 18,
    fontWeight: '600',
    color: COLORS.text,
    marginBottom: 12,
  },
  searchBarContainer: {
    flexDirection: 'row',
    alignItems: 'center',
    backgroundColor: COLORS.gray,
    borderRadius: 20,
    paddingHorizontal: 10,
    marginBottom: 20,
    elevation: 3,
    shadowColor: COLORS.black,
    shadowOffset: { width: 0, height: 2 },
    shadowOpacity: 0.1,
    shadowRadius: 4,
  },
  searchIcon: {
    marginRight: 8,
  },
  searchInput: {
    flex: 1,
    fontSize: 16,
    color: COLORS.text,
    paddingVertical: 8,
  },
  filterIconContainer: {
    padding: 8,
  },
  list: {
    flex: 1,
    width: '100%',
  },
  recipientItem: {
    flexDirection: 'row',
    alignItems: 'center',
    paddingVertical: 8,
  },
  recipientImage: {
    width: 40,
    height: 40,
    borderRadius: 20,
    marginRight: 12,
  },
  recipientTextContainer: {
    flex: 1,
  },
  recipientText: {
    fontSize: 16,
    fontWeight: '600',
    color: COLORS.text,
  },
  recipientSubText: {
    fontSize: 14,
    color: COLORS.placeholder,
  },
  navIcon: {
    marginLeft: 12,
  },
  separator: {
    height: 1,
    backgroundColor: COLORS.gray,
    marginVertical: 4,
  },
  loadingText: {
    fontSize: 16,
    color: COLORS.text,
    textAlign: 'center',
    marginVertical: 20,
  },
  errorText: {
    fontSize: 16,
    color: COLORS.danger,
    textAlign: 'center',
    marginVertical: 20,
  },
  noRecipientsText: {
    fontSize: 16,
    color: COLORS.text,
    textAlign: 'center',
    marginVertical: 20,
  },
  verifyButton: {
    backgroundColor: COLORS.secondary,
    paddingVertical: 10,
    paddingHorizontal: 20,
    borderRadius: 8,
    alignItems: 'center',
    marginVertical: 10,
  },
  verifyButtonText: {
    fontSize: 14,
    fontWeight: '600',
    color: COLORS.white,
  },
});

export default RecipientScreen;
</DOCUMENT>

c:/AutFinanceBank/src/screens/ScanQRScreen.js
<DOCUMENT>
// screens/ScanQRScreen.js
import React from 'react';
import { View, Text } from 'react-native';

const ScanQRScreen = () => (
  <View style={{ flex: 1, justifyContent: 'center', alignItems: 'center' }}>
    <Text>Scan QR Screen</Text>
  </View>
);

export default ScanQRScreen;
</DOCUMENT>

c:/AutFinanceBank/src/screens/SendScreen.js
<DOCUMENT>
import React, { useState, useContext, useEffect, useCallback, useMemo, useRef } from 'react';
import {
  View,
  Text,
  TextInput,
  TouchableOpacity,
  StyleSheet,
  FlatList,
  Image,
  KeyboardAvoidingView,
  Animated,
  Dimensions,
} from 'react-native';
import { useMutation } from 'react-query';
import Icon from 'react-native-vector-icons/MaterialIcons';
import AsyncStorage from '@react-native-async-storage/async-storage';
import { AuthContext } from '../context/AuthContext';
import * as recipientStorage from '../services/recipientStorage';
import { createTransfer } from '../services/transferService';
import globalStyles from '../styles/globalStyles';

const { COLORS } = globalStyles;
const { width } = Dimensions.get('window');

const SendScreen = ({ navigation }) => {
  const { user } = useContext(AuthContext);
  const [screenState, setScreenState] = useState('recipient'); // 'recipient', 'amount', 'recipientInput', 'verify'
  const [selectedRecipient, setSelectedRecipient] = useState(null);
  const [amount, setAmount] = useState('');
  const [errorMessage, setErrorMessage] = useState('');
  const [recipients, setRecipients] = useState([]);
  const [recipientsLoading, setRecipientsLoading] = useState(false);
  const [recipientsError, setRecipientsError] = useState(null);
  const [searchQuery, setSearchQuery] = useState('');
  const [sortByNameAsc, setSortByNameAsc] = useState(true);
  const [manualRecipient, setManualRecipient] = useState('');
  const [recipientType, setRecipientType] = useState('email'); // 'email', 'username', 'cnic'
  const [description, setDescription] = useState(''); // New state for description

  // Animation setup using React Native Animated
  const fadeAnim = useRef(new Animated.Value(1)).current;
  const slideAnim = useRef(new Animated.Value(0)).current;
  const animatedStyle = {
    opacity: fadeAnim,
    transform: [{ translateX: slideAnim }],
  };

  const transitionToScreen = (newScreen) => {
    Animated.timing(fadeAnim, {
      toValue: 0,
      duration: 300,
      useNativeDriver: true,
    }).start(() => {
      setScreenState(newScreen);
      Animated.parallel([
        Animated.timing(fadeAnim, {
          toValue: 1,
          duration: 300,
          useNativeDriver: true,
        }),
        Animated.timing(slideAnim, {
          toValue: 0,
          duration: 300,
          useNativeDriver: true,
        }),
      ]).start();
    });
    Animated.timing(slideAnim, {
      toValue: -width,
      duration: 300,
      useNativeDriver: true,
    }).start();
  };

  // API mutation using createTransfer
  const mutation = useMutation(
    async (transferData) => {
      const { identifier, amount, description } = transferData;
      const response = await createTransfer(identifier, amount, description);
      return response;
    },
    {
      onSuccess: (data) => {
        alert('Transfer initiated successfully!');
        navigation.goBack();
      },
      onError: (error) => {
        setErrorMessage(error.message || 'Failed to initiate transfer');
      },
    }
  );

  // RecipientScreen Logic
  useEffect(() => {
    const loadRecipients = async () => {
      if (!user?.UserID) {
        setRecipientsError('User not authenticated');
        return;
      }
      if (!recipientStorage.setUserId || !recipientStorage.getRecipients) {
        setRecipientsError('Failed to load recipient storage module');
        return;
      }
      try {
        setRecipientsLoading(true);
        setRecipientsError(null);
        await recipientStorage.setUserId(user.UserID);
        const loadedRecipients = await recipientStorage.getRecipients(user.UserID);
        const validRecipients = loadedRecipients?.filter((item) => item && typeof item === 'object' && item.name) || [];
        setRecipients(validRecipients);
      } catch (error) {
        setRecipientsError(error.message || 'Failed to load recipients');
      } finally {
        setRecipientsLoading(false);
      }
    };
    if (screenState === 'recipient') {
      loadRecipients();
    }
  }, [screenState, user?.UserID]);

  const filteredRecipients = useMemo(() => {
    let result = [...recipients];
    if (searchQuery) {
      result = result.filter((item) => {
        if (!item || !item.name) return false;
        return item.name.toLowerCase().includes(searchQuery.toLowerCase());
      });
    }
    result.sort((a, b) => {
      const nameA = a?.name?.toLowerCase() || '';
      const nameB = b?.name?.toLowerCase() || '';
      return sortByNameAsc ? nameA.localeCompare(nameB) : nameB.localeCompare(nameA);
    });
    return result;
  }, [recipients, searchQuery, sortByNameAsc]);

  const renderRecipient = useCallback(
    ({ item }) => {
      if (!item || !item.name) return null;
      return (
        <TouchableOpacity
          style={styles.recipientItem}
          onPress={() => {
            setSelectedRecipient(item);
            transitionToScreen('amount');
          }}
        >
          {item.image ? (
            <Image
              source={{ uri: item.image }}
              style={styles.recipientImage}
              onError={(e) => console.error(`Error loading image for ${item.name}:`, e.nativeEvent.error)}
            />
          ) : (
            <View style={styles.recipientAvatar}>
              <Text style={styles.recipientAvatarText}>{item.name?.[0]?.toUpperCase() || 'R'}</Text>
            </View>
          )}
          <View style={styles.recipientTextContainer}>
            <Text style={styles.recipientText}>{item.name}</Text>
            <Text style={styles.recipientSubText}>{item.email || item.cnic || item.username || 'No contact info'}</Text>
          </View>
          <Icon name="send" size={24} color={COLORS.secondary} style={styles.navIcon} />
        </TouchableOpacity>
      );
    },
    []
  );

  const handleFilterPress = () => setSortByNameAsc((prev) => !prev);

  // Amount Input Screen Logic
  const handleKeyPress = (key) => {
    if (key === 'delete') {
      setAmount((prev) => prev.slice(0, -1));
    } else if (key === '+') {
      // Ignore for now
    } else {
      setAmount((prev) => prev + key);
    }
  };

  const handleAmountSubmit = () => {
    const parsedAmount = parseFloat(amount);
    if (!parsedAmount || parsedAmount <= 0) {
      setErrorMessage('Please enter a valid amount');
      return;
    }
    transitionToScreen('recipientInput');
  };

  // Recipient Input Screen Logic
  const handleRecipientSubmit = () => {
    if (!manualRecipient) {
      setErrorMessage('Please enter a recipient');
      return;
    }
    setSelectedRecipient({
      recipientId: `manual-${Date.now()}`,
      name: manualRecipient,
      [recipientType]: manualRecipient,
    });
    transitionToScreen('verify');
  };

  // Verification Screen Logic
  const handleConfirmSend = async () => {
    if (!selectedRecipient) {
      setErrorMessage('No recipient selected');
      return;
    }
    setErrorMessage('');
    try {
      const identifier = {
        email: selectedRecipient.email || undefined,
        cnic: selectedRecipient.cnic || undefined,
        username: selectedRecipient.username || undefined,
      };
      const transferData = {
        identifier,
        amount: parseFloat(amount),
        description: description || undefined,
      };
      mutation.mutate(transferData);
    } catch (error) {
      setErrorMessage(error.message || 'Invalid input');
    }
  };

  if (!user) {
    return (
      <View style={styles.container}>
        <Text style={styles.errorText}>Please log in to send money</Text>
        <TouchableOpacity
          style={styles.sendButton}
          onPress={() => navigation.navigate('Login')}
        >
          <Text style={styles.sendButtonText}>Go to Login</Text>
        </TouchableOpacity>
      </View>
    );
  }

  return (
    <KeyboardAvoidingView style={styles.container} behavior="padding">
      <Animated.View style={[styles.animatedContainer, animatedStyle]}>
        {screenState === 'recipient' && (
          <View style={styles.recipientContainer}>
            <View style={styles.header}>
              <TouchableOpacity onPress={() => navigation.goBack()}>
                <Icon name="arrow-back" size={28} color={COLORS.text} />
              </TouchableOpacity>
              <Text style={styles.headerTitle}>Send Money</Text>
            </View>
            <View style={styles.sendMoneyContainer}>
              <Text style={styles.sendMoneyHeading}>Send Money Now</Text>
              <Text style={styles.sendMoneySubtext}>Transfer to Your Favorites</Text>
              <TouchableOpacity
                style={styles.sendButton}
                onPress={() => {
                  setSelectedRecipient(null);
                  transitionToScreen('amount');
                }}
              >
                <Text style={styles.sendButtonText}>SEND NOW</Text>
              </TouchableOpacity>
            </View>
            {errorMessage && screenState === 'recipient' && (
              <Text style={styles.errorText}>{errorMessage}</Text>
            )}
            <Text style={styles.findFavouritesHeading}>Find Your Favorites</Text>
            <View style={styles.searchBarContainer}>
              <Icon name="search" size={24} color={COLORS.placeholder} style={styles.searchIcon} />
              <TextInput
                style={styles.searchInput}
                placeholder="Find Favorites"
                placeholderTextColor={COLORS.placeholder}
                value={searchQuery}
                onChangeText={setSearchQuery}
              />
              <TouchableOpacity style={styles.filterIconContainer} onPress={handleFilterPress}>
                <Icon
                  name="sort-by-alpha"
                  size={24}
                  color={COLORS.text}
                  style={{ transform: [{ rotate: sortByNameAsc ? '0deg' : '180deg' }] }}
                />
              </TouchableOpacity>
            </View>
            {recipientsLoading && <Text style={styles.loadingText}>Loading recipients...</Text>}
            {recipientsError && <Text style={styles.errorText}>{recipientsError}</Text>}
            {filteredRecipients.length > 0 ? (
              <FlatList
                data={filteredRecipients}
                renderItem={renderRecipient}
                keyExtractor={(item) => `recipient-${item?.recipientId || Math.random().toString()}`}
                style={styles.list}
                ItemSeparatorComponent={() => <View style={styles.separator} />}
              />
            ) : (
              !recipientsLoading &&
              !recipientsError && <Text style={styles.noRecipientsText}>No recipients found.</Text>
            )}
          </View>
        )}

        {screenState === 'amount' && (
          <View style={styles.amountContainer}>
            <View style={styles.header}>
              <TouchableOpacity onPress={() => transitionToScreen('recipient')}>
                <Icon name="arrow-back" size={28} color={COLORS.text} />
              </TouchableOpacity>
              <Text style={styles.headerTitle}>Set Amount</Text>
            </View>
            <View style={styles.amountDisplayContainer}>
              <Text style={styles.amountLabel}>How much would you like to send?</Text>
              <Text style={styles.amountText}>{amount ? `$${amount}` : '$0'}</Text>
            </View>
            <View style={styles.keypadContainer}>
              {['1', '2', '3', '4', '5', '6', '7', '8', '9', '+', '0', 'delete'].map((key) => (
                <TouchableOpacity
                  key={key}
                  style={styles.keypadButton}
                  onPress={() => handleKeyPress(key)}
                >
                  <Text style={styles.keypadText}>
                    {key === 'delete' ? <Icon name="backspace" size={24} color={COLORS.text} /> : key}
                  </Text>
                </TouchableOpacity>
              ))}
            </View>
            {errorMessage && screenState === 'amount' && (
              <Text style={styles.errorText}>{errorMessage}</Text>
            )}
            <TouchableOpacity
              style={[styles.sendButton, styles.sendNowButton]}
              onPress={handleAmountSubmit}
            >
              <Text style={styles.sendButtonText}>NEXT</Text>
            </TouchableOpacity>
          </View>
        )}

        {screenState === 'recipientInput' && (
          <View style={styles.recipientInputContainer}>
            <View style={styles.header}>
              <TouchableOpacity onPress={() => transitionToScreen('amount')}>
                <Icon name="arrow-back" size={28} color={COLORS.text} />
              </TouchableOpacity>
              <Text style={styles.headerTitle}>Enter Recipient</Text>
            </View>
            <Text style={styles.sectionTitle}>Enter Recipient Details</Text>
            <View style={styles.recipientTypeContainer}>
              {['email', 'username', 'cnic'].map((type) => (
                <TouchableOpacity
                  key={type}
                  style={[
                    styles.recipientTypeButton,
                    recipientType === type && styles.recipientTypeButtonActive,
                  ]}
                  onPress={() => setRecipientType(type)}
                >
                  <Text style={styles.recipientTypeText}>{type.toUpperCase()}</Text>
                </TouchableOpacity>
              ))}
            </View>
            <TextInput
              style={styles.manualInput}
              placeholder={`Enter recipient ${recipientType}`}
              value={manualRecipient}
              onChangeText={setManualRecipient}
              autoCapitalize={recipientType === 'email' ? 'none' : 'words'}
            />
            <TextInput
              style={styles.manualInput}
              placeholder="Description (optional)"
              value={description}
              onChangeText={setDescription}
            />
            {errorMessage && screenState === 'recipientInput' && (
              <Text style={styles.errorText}>{errorMessage}</Text>
            )}
            <TouchableOpacity
              style={styles.sendButton}
              onPress={handleRecipientSubmit}
            >
              <Text style={styles.sendButtonText}>NEXT</Text>
            </TouchableOpacity>
          </View>
        )}

        {screenState === 'verify' && (
          <View style={styles.verifyContainer}>
            <View style={styles.header}>
              <TouchableOpacity onPress={() => transitionToScreen('recipientInput')}>
                <Icon name="arrow-back" size={28} color={COLORS.text} />
              </TouchableOpacity>
              <Text style={styles.headerTitle}>Verify Transfer</Text>
            </View>
            {selectedRecipient ? (
              <>
                <Text style={styles.verifyTitle}>Please Confirm Details</Text>
                <View style={styles.verifyDetail}>
                  <Text style={styles.verifyLabel}>Recipient:</Text>
                  <Text style={styles.verifyValue}>{selectedRecipient.name || 'Unknown'}</Text>
                </View>
                <View style={styles.verifyDetail}>
                  <Text style={styles.verifyLabel}>Contact:</Text>
                  <Text style={styles.verifyValue}>
                    {selectedRecipient.email || selectedRecipient.cnic || selectedRecipient.username || 'N/A'}
                  </Text>
                </View>
                <View style={styles.verifyDetail}>
                  <Text style={styles.verifyLabel}>Amount:</Text>
                  <Text style={styles.verifyValue}>${amount}</Text>
                </View>
                {description && (
                  <View style={styles.verifyDetail}>
                    <Text style={styles.verifyLabel}>Description:</Text>
                    <Text style={styles.verifyValue}>{description}</Text>
                  </View>
                )}
                {errorMessage && <Text style={styles.errorText}>{errorMessage}</Text>}
                <TouchableOpacity
                  style={[styles.sendButton, mutation.isLoading && { opacity: 0.7 }]}
                  onPress={handleConfirmSend}
                  disabled={mutation.isLoading}
                >
                  <Text style={styles.sendButtonText}>
                    {mutation.isLoading ? 'Sending...' : 'Confirm & Send'}
                  </Text>
                </TouchableOpacity>
              </>
            ) : (
              <View style={styles.verifyErrorContainer}>
                <Text style={styles.errorText}>No recipient selected. Please go back and enter a recipient.</Text>
                <TouchableOpacity
                  style={styles.sendButton}
                  onPress={() => transitionToScreen('recipientInput')}
                >
                  <Text style={styles.sendButtonText}>Go Back</Text>
                </TouchableOpacity>
              </View>
            )}
          </View>
        )}
      </Animated.View>
    </KeyboardAvoidingView>
  );
};

const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: COLORS.background,
  },
  animatedContainer: {
    flex: 1,
  },
  header: {
    flexDirection: 'row',
    alignItems: 'center',
    padding: 16,
    backgroundColor: COLORS.white,
    elevation: 4,
    shadowColor: COLORS.black,
    shadowOffset: { width: 0, height: 2 },
    shadowOpacity: 0.1,
    shadowRadius: 4,
  },
  headerTitle: {
    fontSize: 20,
    fontWeight: 'bold',
    color: COLORS.text,
    marginLeft: 16,
  },
  // Recipient Screen Styles
  recipientContainer: {
    flex: 1,
    paddingHorizontal: 16,
    paddingTop: 10,
  },
  sendMoneyContainer: {
    marginBottom: 20,
    alignItems: 'center',
  },
  sendMoneyHeading: {
    fontSize: 24,
    fontWeight: '700',
    color: COLORS.text,
    marginBottom: 8,
  },
  sendMoneySubtext: {
    fontSize: 16,
    color: COLORS.placeholder,
    marginBottom: 20,
  },
  sendButton: {
    backgroundColor: COLORS.primary,
    paddingVertical: 12,
    paddingHorizontal: 40,
    borderRadius: 25,
    alignItems: 'center',
    elevation: 5,
    shadowColor: COLORS.black,
    shadowOffset: { width: 0, height: 2 },
    shadowOpacity: 0.2,
    shadowRadius: 4,
  },
  sendButtonText: {
    fontSize: 16,
    fontWeight: 'bold',
    color: COLORS.white,
  },
  findFavouritesHeading: {
    fontSize: 18,
    fontWeight: '600',
    color: COLORS.text,
    marginBottom: 12,
  },
  searchBarContainer: {
    flexDirection: 'row',
    alignItems: 'center',
    backgroundColor: COLORS.gray,
    borderRadius: 20,
    paddingHorizontal: 10,
    marginBottom: 20,
    elevation: 3,
  },
  searchIcon: {
    marginRight: 8,
  },
  searchInput: {
    flex: 1,
    fontSize: 16,
    color: COLORS.text,
    paddingVertical: 8,
  },
  filterIconContainer: {
    padding: 8,
  },
  list: {
    flex: 1,
  },
  recipientItem: {
    flexDirection: 'row',
    alignItems: 'center',
    paddingVertical: 8,
  },
  recipientImage: {
    width: 40,
    height: 40,
    borderRadius: 20,
    marginRight: 12,
  },
  recipientAvatar: {
    width: 40,
    height: 40,
    borderRadius: 20,
    backgroundColor: COLORS.gray,
    justifyContent: 'center',
    alignItems: 'center',
    marginRight: 12,
  },
  recipientAvatarText: {
    fontSize: 18,
    fontWeight: 'bold',
    color: COLORS.text,
  },
  recipientTextContainer: {
    flex: 1,
  },
  recipientText: {
    fontSize: 16,
    fontWeight: '600',
    color: COLORS.text,
  },
  recipientSubText: {
    fontSize: 14,
    color: COLORS.placeholder,
  },
  navIcon: {
    marginLeft: 12,
  },
  separator: {
    height: 1,
    backgroundColor: COLORS.gray,
    marginVertical: 4,
  },
  loadingText: {
    fontSize: 16,
    color: COLORS.text,
    textAlign: 'center',
    marginVertical: 20,
  },
  errorText: {
    fontSize: 16,
    color: COLORS.danger,
    textAlign: 'center',
    marginVertical: 10,
  },
  noRecipientsText: {
    fontSize: 16,
    color: COLORS.text,
    textAlign: 'center',
    marginVertical: 20,
  },
  // Amount Input Screen Styles
  amountContainer: {
    flex: 1,
    paddingHorizontal: 16,
    backgroundColor: COLORS.white,
  },
  amountDisplayContainer: {
    backgroundColor: COLORS.primary,
    borderRadius: 15,
    padding: 20,
    marginVertical: 30,
    alignItems: 'center',
    elevation: 5,
  },
  amountLabel: {
    fontSize: 18,
    color: COLORS.white,
    marginBottom: 10,
  },
  amountText: {
    fontSize: 40,
    fontWeight: 'bold',
    color: COLORS.white,
  },
  keypadContainer: {
    flexDirection: 'row',
    flexWrap: 'wrap',
    justifyContent: 'space-between',
    marginBottom: 20,
  },
  keypadButton: {
    width: width / 3 - 20,
    height: 60,
    borderRadius: 30,
    backgroundColor: COLORS.gray,
    justifyContent: 'center',
    alignItems: 'center',
    marginVertical: 5,
    elevation: 2,
  },
  keypadText: {
    fontSize: 24,
    fontWeight: 'bold',
    color: COLORS.text,
  },
  sendNowButton: {
    width: '100%',
    paddingVertical: 15,
  },
  // Recipient Input Screen Styles
  recipientInputContainer: {
    flex: 1,
    paddingHorizontal: 16,
    paddingTop: 20,
    backgroundColor: COLORS.white,
  },
  sectionTitle: {
    fontSize: 18,
    fontWeight: '600',
    color: COLORS.text,
    marginBottom: 16,
  },
  recipientTypeContainer: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    marginBottom: 16,
  },
  recipientTypeButton: {
    flex: 1,
    padding: 10,
    borderWidth: 1,
    borderColor: COLORS.gray,
    borderRadius: 8,
    alignItems: 'center',
    marginHorizontal: 5,
  },
  recipientTypeButtonActive: {
    backgroundColor: COLORS.primary,
    borderColor: COLORS.primary,
  },
  recipientTypeText: {
    color: COLORS.text,
    fontSize: 14,
  },
  manualInput: {
    borderWidth: 1,
    borderColor: COLORS.gray,
    borderRadius: 8,
    padding: 10,
    marginBottom: 16,
    fontSize: 16,
    color: COLORS.text,
  },
  // Verification Screen Styles
  verifyContainer: {
    flex: 1,
    paddingHorizontal: 16,
    paddingTop: 20,
    backgroundColor: COLORS.white,
  },
  verifyErrorContainer: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center',
  },
  verifyTitle: {
    fontSize: 22,
    fontWeight: 'bold',
    color: COLORS.text,
    marginVertical: 20,
    textAlign: 'center',
  },
  verifyDetail: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    paddingVertical: 10,
    borderBottomWidth: 1,
    borderBottomColor: COLORS.gray,
  },
  verifyLabel: {
    fontSize: 16,
    fontWeight: '600',
    color: COLORS.text,
  },
  verifyValue: {
    fontSize: 16,
    color: COLORS.text,
  },
});

export default SendScreen;
</DOCUMENT>

c:/AutFinanceBank/src/screens/SettingsScreen.js
<DOCUMENT>
// screens/SettingsScreen.js
import React from 'react';
import { View, Text } from 'react-native';

const SettingsScreen = () => (
  <View style={{ flex: 1, justifyContent: 'center', alignItems: 'center' }}>
    <Text>Settings Screen</Text>
  </View>
);

export default SettingsScreen;
</DOCUMENT>

c:/AutFinanceBank/src/screens/SignupScreen.js
<DOCUMENT>
import React, { useState } from "react";
import {
  View,
  Text,
  TextInput,
  TouchableOpacity,
  Modal,
  FlatList,
  StyleSheet,
} from "react-native";
import globalStyles from "../styles/globalStyles";

const SignupScreen = ({ navigation }) => {
  const [username, setUsername] = useState("");
  const [cnic, setCnic] = useState("");
  const [email, setEmail] = useState("");
  const [password, setPassword] = useState("");
  const [accountType, setAccountType] = useState("Savings");
  const [errorMessage, setErrorMessage] = useState("");
  const [isLoading, setIsLoading] = useState(false);
  const [dropdownVisible, setDropdownVisible] = useState(false);

  const accountTypes = [
    { label: "Savings", value: "Savings" },
    { label: "Current", value: "Current" },
  ];

  const validateInputs = () => {
    if (!username || !cnic || !email || !password) {
      setErrorMessage("All fields are required");
      return false;
    }
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(email)) {
      setErrorMessage("Please enter a valid email address");
      return false;
    }
    if (cnic.length !== 13 || isNaN(cnic)) {
      setErrorMessage("Please enter a valid 13-digit CNIC number");
      return false;
    }
    if (password.length < 6) {
      setErrorMessage("Password must be at least 6 characters long");
      return false;
    }
    return true;
  };

  const handleSignup = async () => {
    setErrorMessage("");
    setIsLoading(true);
    try {
      if (!validateInputs()) {
        setIsLoading(false);
        return;
      }
      console.log("Registering user", { username, cnic, email, password, accountType });
      navigation.replace("Login");
    } catch (error) {
      setErrorMessage("Signup failed. Please try again.");
      console.error("Signup error:", error);
    } finally {
      setIsLoading(false);
    }
  };

  const renderDropdownItem = ({ item }) => (
    <TouchableOpacity
      style={styles.dropdownItem}
      onPress={() => {
        setAccountType(item.value);
        setDropdownVisible(false);
      }}
    >
      <Text style={styles.dropdownItemText}>{item.label}</Text>
    </TouchableOpacity>
  );

  return (
    <View style={globalStyles.container}>
      <Text style={globalStyles.title}>Register</Text>

      <TextInput
        style={globalStyles.input}
        placeholder="Username"
        value={username}
        onChangeText={setUsername}
        autoCapitalize="none"
        editable={!isLoading}
      />
      <TextInput
        style={globalStyles.input}
        placeholder="CNIC"
        keyboardType="numeric"
        value={cnic}
        onChangeText={setCnic}
        maxLength={13}
        editable={!isLoading}
      />
      <TextInput
        style={globalStyles.input}
        placeholder="Email"
        keyboardType="email-address"
        value={email}
        onChangeText={setEmail}
        autoCapitalize="none"
        editable={!isLoading}
      />
      <TextInput
        style={globalStyles.input}
        placeholder="Password"
        secureTextEntry
        value={password}
        onChangeText={setPassword}
        editable={!isLoading}
      />

      {/* Custom Dropdown */}
      <TouchableOpacity
        style={[globalStyles.input, styles.dropdownButton]}
        onPress={() => !isLoading && setDropdownVisible(true)}
        disabled={isLoading}
      >
        <Text>{accountType}</Text>
      </TouchableOpacity>

      <Modal
        visible={dropdownVisible}
        transparent
        animationType="fade"
        onRequestClose={() => setDropdownVisible(false)}
      >
        <TouchableOpacity
          style={styles.modalOverlay}
          onPress={() => setDropdownVisible(false)}
        >
          <View style={styles.dropdownContainer}>
            <FlatList
              data={accountTypes}
              renderItem={renderDropdownItem}
              keyExtractor={(item) => item.value}
            />
          </View>
        </TouchableOpacity>
      </Modal>

      {errorMessage ? <Text style={globalStyles.error}>{errorMessage}</Text> : null}

      <TouchableOpacity
        style={[globalStyles.button, isLoading && { opacity: 0.7 }]}
        onPress={handleSignup}
        disabled={isLoading}
      >
        <Text style={globalStyles.buttonText}>
          {isLoading ? "Signing Up..." : "Sign Up"}
        </Text>
      </TouchableOpacity>

      <TouchableOpacity
        onPress={() => navigation.navigate("Login")}
        disabled={isLoading}
      >
        <Text style={globalStyles.linkText}>Already have an account? Login</Text>
      </TouchableOpacity>
    </View>
  );
};

// Additional styles for the custom dropdown
const styles = StyleSheet.create({
  dropdownButton: {
    justifyContent: "center",
    paddingHorizontal: 10,
  },
  modalOverlay: {
    flex: 1,
    backgroundColor: "rgba(0,0,0,0.5)",
    justifyContent: "center",
    alignItems: "center",
  },
  dropdownContainer: {
    backgroundColor: "white",
    width: "80%",
    maxHeight: 200,
    borderRadius: 5,
    overflow: "hidden",
  },
  dropdownItem: {
    padding: 15,
    borderBottomWidth: 1,
    borderBottomColor: "#eee",
  },
  dropdownItemText: {
    fontSize: 16,
  },
});

export default SignupScreen;
</DOCUMENT>

c:/AutFinanceBank/src/screens/SplashScreen.js
<DOCUMENT>
import React, { useEffect, useContext } from 'react';
import { View, Text } from 'react-native';
import { useNavigation } from '@react-navigation/native';
import { AuthContext } from '../context/AuthContext';
import globalStyles from '../styles/globalStyles';

const SplashScreen = () => {
  const navigation = useNavigation();
  const { user } = useContext(AuthContext);

  useEffect(() => {
    const timer = setTimeout(() => {
      if (user) {
        console.log('SplashScreen: User exists, navigating to Home');
        navigation.replace('Home');
      } else {
        console.log('SplashScreen: No user, navigating to Onboarding');
        navigation.replace('Onboarding');
      }
    }, 3000); // 3 seconds

    return () => clearTimeout(timer);
  }, [navigation, user]);

  return (
    <View style={globalStyles.centeredContainer}>
      {/* Logo: Two overlapping circles */}
      <View style={globalStyles.logoContainer}>
        <View style={[globalStyles.circle, globalStyles.circlePrimary]} />
        <View style={[globalStyles.circle, globalStyles.circleSecondary]} />
      </View>

      {/* Main text: "Aut Bank" */}
      <Text style={globalStyles.textXLarge}>Aut Bank</Text>

      {/* Subtext: "Your Best Money Transfer Partner." */}
      <Text style={globalStyles.textSmall}>Your Best Money Transfer Partner.</Text>

      {/* Footer text: "Secured by TransferMe." */}
      <Text
        style={[
          globalStyles.textSmall,
          {
            position: 'absolute',
            bottom: globalStyles.SPACING.large,
            fontSize: globalStyles.FONT_SIZES.small,
            color: globalStyles.COLORS.secondary,
          },
        ]}
      >
        Secured by TransferMe.
      </Text>
    </View>
  );
};

export default SplashScreen;
</DOCUMENT>

c:/AutFinanceBank/src/screens/TransactionsScreen.js
<DOCUMENT>
import React, { useState, useContext } from 'react';
import { View, Text, FlatList, TouchableOpacity, StyleSheet } from 'react-native';
import { useQuery } from 'react-query';
import { AuthContext } from '../context/AuthContext';
import { getLastTenTransactions, exportTransactions } from '../services/transactionService';
import { formatCurrency } from '../utils/helpers';
import globalStyles from '../styles/globalStyles';

const TransactionsScreen = () => {
  const { user } = useContext(AuthContext);
  const [page, setPage] = useState(1);
  const [perPage] = useState(10);


  const { data: transactions, isLoading, refetch } = useQuery(
    ['transactions', { page, per_page: perPage }],
    () => getLastTenTransactions(),
    { enabled: !!user }
  );
  

  const handleExport = async () => {
    try {
      const response = await exportTransactions();
      // Handle CSV download (e.g., save to device or open)
      alert('Transactions exported successfully');
    } catch (error) {
      alert(error.message || 'Failed to export transactions');
    }
  };

  const renderTransaction = ({ item }) => {
    const isDeposit = !!item.DepositID;
    const transactionType = isDeposit ? 'Deposit' : 'Transfer';
    const transactionId = item.DepositID || item.TransferID;

    return (
      <View style={styles.transaction}>
        <Text style={[styles.transactionIcon, { color: isDeposit ? '#2ecc71' : '#e74c3c' }]}>
          {isDeposit ? '‚Üì' : '‚Üë'}
        </Text>
        <View style={styles.transactionDetails}>
          <Text style={styles.transactionDescription}>{item.Description || transactionType}</Text>
          <Text style={styles.transactionDate}>
            {new Date(item.Timestamp).toLocaleString()}
          </Text>
        </View>
        <Text style={[styles.transactionAmount, { color: isDeposit ? '#2ecc71' : '#e74c3c' }]}>
          {isDeposit ? '+' : '-'}{formatCurrency(item.Amount)}
        </Text>
      </View>
    );
  };

  if (!user) {
    return (
      <View style={globalStyles.container}>
        <Text>Please log in to view transactions</Text>
      </View>
    );
  }

  return (
    <View style={globalStyles.container}>
      <Text style={[globalStyles.textXLargeBlack, { marginBottom: globalStyles.SPACING.large }]}>
        Transaction History
      </Text>
      {isLoading ? (
        <Text>Loading transactions...</Text>
      ) : !transactions?.data?.items?.length ? (
        <Text>No transactions available</Text>
      ) : (
        <>
          <FlatList
            data={transactions?.data?.items || []}
            renderItem={renderTransaction}
            keyExtractor={(item) => (item.DepositID || item.TransferID).toString()}
            onEndReached={() => transactions?.total_pages > page && setPage(page + 1)}
            onEndReachedThreshold={0.5}
          />
          <TouchableOpacity style={globalStyles.button} onPress={handleExport}>
            <Text style={globalStyles.buttonText}>Export Transactions</Text>
          </TouchableOpacity>
        </>
      )}
    </View>
  );
};

const styles = StyleSheet.create({
  transaction: {
    flexDirection: 'row',
    alignItems: 'center',
    paddingVertical: 8,
    borderBottomWidth: 1,
    borderBottomColor: globalStyles.COLORS.gray,
  },
  transactionIcon: {
    fontSize: 20,
    marginRight: 8,
  },
  transactionDetails: {
    flex: 1,
  },
  transactionDescription: {
    fontSize: 16,
    fontWeight: '600',
    color: '#333',
  },
  transactionDate: {
    fontSize: 14,
    color: '#777',
  },
  transactionAmount: {
    fontSize: 16,
    fontWeight: '600',
  },
});

export default TransactionsScreen;
</DOCUMENT>

c:/AutFinanceBank/src/screens/WelcomeScreen.js
<DOCUMENT>
import React, { useEffect } from 'react';
import { View, Text, StyleSheet } from 'react-native';
import AsyncStorage from '@react-native-async-storage/async-storage';
import { useNavigation } from '@react-navigation/native';

const WelcomeScreen = () => {
  const navigation = useNavigation();

  useEffect(() => {
    const initializeApp = async () => {
      try {
        // Clear AsyncStorage to remove any existing account
        await AsyncStorage.clear();
        console.log('AsyncStorage cleared');
      } catch (error) {
        console.error('Error clearing AsyncStorage:', error);
      } finally {
        // Navigate to Login Screen after 2 seconds
        setTimeout(() => {
          navigation.replace('Login');
        }, 2000);
      }
    };

    initializeApp();
  }, [navigation]);

  return (
    <View style={styles.container}>
      <Text style={styles.title}>AutFinanceBank</Text>
    </View>
  );
};

const styles = StyleSheet.create({
  container: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center',
    backgroundColor: '#007bff',
  },
  title: {
    fontSize: 32,
    fontWeight: 'bold',
    color: '#fff',
  },
});

export default WelcomeScreen;
</DOCUMENT>

c:/AutFinanceBank/src/screens/WithdrawScreen.js
<DOCUMENT>
// screens/BillsScreen.js
import React from 'react';
import { View, Text } from 'react-native';

const WithdrawScreen = () => (
  <View style={{ flex: 1, justifyContent: 'center', alignItems: 'center' }}>
    <Text>Withdraw Screen</Text>
  </View>
);

export default WithdrawScreen;
</DOCUMENT>

c:/AutFinanceBank/src/screens/SignupStep/SignupStep1.js
<DOCUMENT>
import React, { useState } from 'react';
import { View, Text, TextInput, TouchableOpacity, KeyboardAvoidingView, ScrollView, Platform } from 'react-native';
import { checkUniqueness } from '../../services/userService';
import globalStyles from '../../styles/globalStyles';

const SignupStep1 = ({ navigation }) => {
  const [firstName, setFirstName] = useState('');
  const [lastName, setLastName] = useState('');
  const [username, setUsername] = useState('');
  const [errorMessage, setErrorMessage] = useState('');
  const [isLoading, setIsLoading] = useState(false);

  const validateInputs = async () => {
    const trimmedFirstName = firstName.trim();
    const trimmedLastName = lastName.trim();
    const trimmedUsername = username.trim();

    if (!trimmedFirstName || !trimmedLastName || !trimmedUsername) {
      setErrorMessage('All fields are required');
      return false;
    }

    if (trimmedUsername.length < 3) {
      setErrorMessage('Username must be at least 3 characters');
      return false;
    }

    try {
      const result = await checkUniqueness('Username', trimmedUsername);
      
      if (!result.success || !result.data?.is_unique) {
        setErrorMessage('Username is already taken.');
        return false;
      }
    
      return true;
    } catch (error) {
      console.error('SignupStep1 checkUsernameUnique error:', error);
      setErrorMessage('Failed to validate username. Please try again.');
      return false;
    }
  };

  const handleNext = async () => {
    setErrorMessage('');
    setIsLoading(true);
    try {
      if (!(await validateInputs())) {
        return;
      }
      console.log('SignupStep1: Navigating to SignupStep2 with data:', {
        firstName: firstName.trim(),
        lastName: lastName.trim(),
        username: username.trim(),
      });
      navigation.navigate('SignupStep2', {
        signupData: {
          firstName: firstName.trim(),
          lastName: lastName.trim(),
          username: username.trim(),
        },
      });
    } catch (error) {
      console.error('SignupStep1 handleNext error:', error);
      setErrorMessage('An error occurred. Please try again.');
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <KeyboardAvoidingView
      style={{ flex: 1 }}
      behavior={Platform.OS === 'ios' ? 'padding' : 'height'}
      keyboardVerticalOffset={Platform.OS === 'ios' ? 0 : 20}
    >
      <ScrollView contentContainerStyle={{ flexGrow: 1 }}>
        <View style={[globalStyles.container, { alignItems: 'flex-start' }]}>
          <View style={[globalStyles.logoContainer, { marginLeft: globalStyles.SPACING.medium, marginTop: globalStyles.SPACING.large }]}>
            <View style={[globalStyles.circle, globalStyles.circlePrimary]} />
            <View style={[globalStyles.circle, globalStyles.circleSecondary]} />
          </View>
          <Text style={[globalStyles.textXLargeBlack, { marginBottom: globalStyles.SPACING.large, alignSelf: 'center' }]}>
            Sign Up
          </Text>
          <View style={globalStyles.dotContainer}>
            {[...Array(6)].map((_, index) => (
              <View
                key={index}
                style={[
                  globalStyles.dot,
                  index === 0 ? globalStyles.dotActive : globalStyles.dotInactive,
                ]}
              />
            ))}
          </View>
          <TextInput
            style={globalStyles.input}
            placeholder="First Name"
            placeholderTextColor={globalStyles.COLORS.placeholder}
            value={firstName}
            onChangeText={setFirstName}
            autoCapitalize="words"
            editable={!isLoading}
          />
          <TextInput
            style={globalStyles.input}
            placeholder="Last Name"
            placeholderTextColor={globalStyles.COLORS.placeholder}
            value={lastName}
            onChangeText={setLastName}
            autoCapitalize="words"
            editable={!isLoading}
          />
          <TextInput
            style={globalStyles.input}
            placeholder="Username"
            placeholderTextColor={globalStyles.COLORS.placeholder}
            value={username}
            onChangeText={setUsername}
            autoCapitalize="none"
            editable={!isLoading}
          />
          {errorMessage ? <Text style={globalStyles.textError}>{errorMessage}</Text> : null}
          <TouchableOpacity
            style={[globalStyles.button, isLoading && { opacity: 0.7 }, { alignSelf: 'center' }]}
            onPress={handleNext}
            disabled={isLoading}
          >
            <Text style={globalStyles.buttonText}>{isLoading ? 'Checking...' : 'Next'}</Text>
          </TouchableOpacity>
        </View>
      </ScrollView>
    </KeyboardAvoidingView>
  );
};

export default SignupStep1;
</DOCUMENT>

c:/AutFinanceBank/src/screens/SignupStep/SignupStep2.js
<DOCUMENT>
import React, { useState } from 'react';
import {
  View, Text, TextInput, TouchableOpacity, Modal,
  StyleSheet, KeyboardAvoidingView, ScrollView, Platform
} from 'react-native';
import DateTimePicker from '@react-native-community/datetimepicker';
import { format } from 'date-fns';
import { checkUniqueness } from '../../services/userService';
import globalStyles from '../../styles/globalStyles';

const SignupStep2 = ({ navigation, route }) => {
  const { signupData } = route.params;
  const [cnic, setCnic] = useState('');
  const [dateOfBirth, setDateOfBirth] = useState(new Date(2000, 0, 1));
  const [showDatePicker, setShowDatePicker] = useState(false);
  const [phoneNumber, setPhoneNumber] = useState('');
  const [errorMessage, setErrorMessage] = useState('');
  const [isLoading, setIsLoading] = useState(false);

  const formatCnic = (input) => {
    const digits = input.replace(/\D/g, '');
    if (digits.length <= 5) return digits;
    if (digits.length <= 12) return `${digits.slice(0, 5)}-${digits.slice(5)}`;
    return `${digits.slice(0, 5)}-${digits.slice(5, 12)}-${digits.slice(12, 13)}`;
  };

  const validateInputs = async () => {
    const trimmedPhoneNumber = phoneNumber.trim();
    const formattedCnic = formatCnic(cnic);

    if (!formattedCnic || !trimmedPhoneNumber) {
      setErrorMessage('All fields are required');
      return false;
    }

    if (!/^\d{5}-\d{7}-\d{1}$/.test(formattedCnic)) {
      setErrorMessage('Please enter CNIC in format 12345-1234567-1');
      return false;
    }

    const today = new Date();
    const age = today.getFullYear() - dateOfBirth.getFullYear() -
      (today.getMonth() < dateOfBirth.getMonth() ||
      (today.getMonth() === dateOfBirth.getMonth() && today.getDate() < dateOfBirth.getDate()) ? 1 : 0);
    if (age < 18) {
      setErrorMessage('You must be at least 18 years old to sign up');
      return false;
    }

    const phoneRegex = /^\+?\d{10,15}$/;
    if (!phoneRegex.test(trimmedPhoneNumber)) {
      setErrorMessage('Please enter a valid phone number (10-15 digits, optional + prefix)');
      return false;
    }

    try {
      const result = await checkUniqueness('CNIC', formattedCnic);
      if (!result.success || !result.data?.is_unique) {
        setErrorMessage('CNIC is already taken.');
        return false;
      }
      return true;
    } catch (error) {
      console.error('SignupStep2 checkCnicUnique error:', error);
      setErrorMessage('Failed to validate CNIC. Please try again.');
      return false;
    }
  };

  const handleNext = async () => {
    setErrorMessage('');
    setIsLoading(true);
    try {
      const isValid = await validateInputs();
      if (!isValid) return;

      const formattedCnic = formatCnic(cnic);
      const trimmedPhoneNumber = phoneNumber.trim();

      console.log('SignupStep2: Navigating to SignupStep3 with data:', {
        ...signupData,
        cnic: formattedCnic,
        dateOfBirth: format(dateOfBirth, 'yyyy-MM-dd'),
        phoneNumber: trimmedPhoneNumber,
      });

      navigation.navigate('SignupStep3', {
        signupData: {
          ...signupData,
          cnic: formattedCnic,
          dateOfBirth: format(dateOfBirth, 'yyyy-MM-dd'),
          phoneNumber: trimmedPhoneNumber,
        },
      });
    } catch (error) {
      console.error('SignupStep2 handleNext error:', error);
      setErrorMessage('An error occurred. Please try again.');
    } finally {
      setIsLoading(false);
    }
  };

  const onDateChange = (event, selectedDate) => {
    const currentDate = selectedDate || dateOfBirth;
    setShowDatePicker(Platform.OS === 'ios'); // Auto-close on Android
    setDateOfBirth(currentDate);
  };

  return (
    <KeyboardAvoidingView
      style={{ flex: 1 }}
      behavior={Platform.OS === 'ios' ? 'padding' : 'height'}
      keyboardVerticalOffset={Platform.OS === 'ios' ? 0 : 20}
    >
      <ScrollView contentContainerStyle={{ flexGrow: 1 }}>
        <View style={[globalStyles.container, { alignItems: 'flex-start' }]}>
          <View style={[globalStyles.logoContainer, { marginLeft: globalStyles.SPACING.medium, marginTop: globalStyles.SPACING.large }]}>
            <View style={[globalStyles.circle, globalStyles.circlePrimary]} />
            <View style={[globalStyles.circle, globalStyles.circleSecondary]} />
          </View>
          <Text style={[globalStyles.textXLargeBlack, { marginBottom: globalStyles.SPACING.large, alignSelf: 'center' }]}>
            Sign Up
          </Text>
          <View style={globalStyles.dotContainer}>
            {[...Array(6)].map((_, index) => (
              <View
                key={index}
                style={[
                  globalStyles.dot,
                  index === 1 ? globalStyles.dotActive : globalStyles.dotInactive,
                ]}
              />
            ))}
          </View>

          <TextInput
            style={globalStyles.input}
            placeholder="CNIC (e.g., 12345-6789012-3)"
            placeholderTextColor={globalStyles.COLORS.placeholder}
            keyboardType="numeric"
            value={cnic}
            onChangeText={(text) => setCnic(formatCnic(text))}
            maxLength={15}
            editable={!isLoading}
          />

          <TouchableOpacity
            style={globalStyles.input}
            onPress={() => !isLoading && setShowDatePicker(true)}
            disabled={isLoading}
          >
            <Text style={{ color: globalStyles.COLORS.text }}>
              {format(dateOfBirth, 'yyyy-MM-dd')}
            </Text>
          </TouchableOpacity>

          {showDatePicker && (
            <Modal transparent animationType="fade">
              <View style={styles.datePickerModal}>
                <View style={styles.datePickerContainer}>
                  <DateTimePicker
                    value={dateOfBirth}
                    mode="date"
                    display="default"
                    onChange={onDateChange}
                    maximumDate={new Date()}
                  />
                  {Platform.OS === 'ios' && (
                    <TouchableOpacity
                      style={styles.datePickerButton}
                      onPress={() => setShowDatePicker(false)}
                    >
                      <Text style={styles.datePickerButtonText}>Done</Text>
                    </TouchableOpacity>
                  )}
                </View>
              </View>
            </Modal>
          )}

          <TextInput
            style={globalStyles.input}
            placeholder="Phone Number (e.g., +1234567890)"
            placeholderTextColor={globalStyles.COLORS.placeholder}
            keyboardType="phone-pad"
            value={phoneNumber}
            onChangeText={setPhoneNumber}
            editable={!isLoading}
          />

          {errorMessage ? <Text style={globalStyles.textError}>{errorMessage}</Text> : null}

          <TouchableOpacity
            style={[globalStyles.button, isLoading && { opacity: 0.7 }, { alignSelf: 'center' }]}
            onPress={handleNext}
            disabled={isLoading}
          >
            <Text style={globalStyles.buttonText}>{isLoading ? 'Checking...' : 'Next'}</Text>
          </TouchableOpacity>
        </View>
      </ScrollView>
    </KeyboardAvoidingView>
  );
};

const styles = StyleSheet.create({
  datePickerModal: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center',
    backgroundColor: 'rgba(0,0,0,0.5)',
  },
  datePickerContainer: {
    backgroundColor: 'white',
    borderRadius: 10,
    padding: 20,
    alignItems: 'center',
  },
  datePickerButton: {
    marginTop: 10,
    backgroundColor: globalStyles.COLORS.primary,
    paddingVertical: 10,
    paddingHorizontal: 20,
    borderRadius: 5,
  },
  datePickerButtonText: {
    color: globalStyles.COLORS.white,
    fontSize: 16,
  },
});

export default SignupStep2;
</DOCUMENT>

c:/AutFinanceBank/src/screens/SignupStep/SignupStep3.js
<DOCUMENT>
import React, { useState } from 'react';
import { View, Text, TextInput, TouchableOpacity, KeyboardAvoidingView, ScrollView, Platform } from 'react-native';
import globalStyles from '../../styles/globalStyles';

const SignupStep3 = ({ navigation, route }) => {
  const { signupData } = route.params;
  const [streetAddress, setStreetAddress] = useState('');
  const [city, setCity] = useState('');
  const [country, setCountry] = useState('');
  const [postalCode, setPostalCode] = useState('');
  const [errorMessage, setErrorMessage] = useState('');
  const [isLoading, setIsLoading] = useState(false);

  const validateInputs = () => {
    const trimmedStreetAddress = streetAddress.trim();
    const trimmedCity = city.trim();
    const trimmedCountry = country.trim();
    const trimmedPostalCode = postalCode.trim();

    if (!trimmedStreetAddress || !trimmedCity || !trimmedCountry || !trimmedPostalCode) {
      setErrorMessage('All fields are required');
      return false;
    }

    const postalCodeRegex = /^[a-zA-Z0-9]{4,10}$/;
    if (!postalCodeRegex.test(trimmedPostalCode)) {
      setErrorMessage('Postal code must be 4-10 alphanumeric characters');
      return false;
    }

    return true;
  };

  const handleNext = () => {
    setErrorMessage('');
    setIsLoading(true);
    try {
      if (!validateInputs()) {
        setIsLoading(false);
        return;
      }
      const trimmedData = {
        streetAddress: streetAddress.trim(),
        city: city.trim(),
        country: country.trim(),
        postalCode: postalCode.trim(),
      };
      console.log('SignupStep3: Navigating to SignupStep4 with data:', {
        ...signupData,
        ...trimmedData,
      });
      navigation.navigate('SignupStep4', {
        signupData: {
          ...signupData,
          ...trimmedData,
        },
      });
    } catch (error) {
      console.error('SignupStep3 handleNext error:', error);
      setErrorMessage('An error occurred. Please try again.');
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <KeyboardAvoidingView
      style={{ flex: 1 }}
      behavior={Platform.OS === 'ios' ? 'padding' : 'height'}
      keyboardVerticalOffset={Platform.OS === 'ios' ? 0 : 20}
    >
      <ScrollView contentContainerStyle={{ flexGrow: 1 }}>
        <View style={[globalStyles.container, { alignItems: 'flex-start' }]}>
          <View style={[globalStyles.logoContainer, { marginLeft: globalStyles.SPACING.medium, marginTop: globalStyles.SPACING.large }]}>
            <View style={[globalStyles.circle, globalStyles.circlePrimary]} />
            <View style={[globalStyles.circle, globalStyles.circleSecondary]} />
          </View>
          <Text style={[globalStyles.textXLargeBlack, { marginBottom: globalStyles.SPACING.large, alignSelf: 'center' }]}>
            Sign Up
          </Text>
          <View style={globalStyles.dotContainer}>
            {[...Array(6)].map((_, index) => (
              <View
                key={index}
                style={[
                  globalStyles.dot,
                  index === 2 ? globalStyles.dotActive : globalStyles.dotInactive,
                ]}
              />
            ))}
          </View>
          <TextInput
            style={globalStyles.input}
            placeholder="Street Address"
            placeholderTextColor={globalStyles.COLORS.placeholder}
            value={streetAddress}
            onChangeText={setStreetAddress}
            autoCapitalize="words"
            editable={!isLoading}
          />
          <TextInput
            style={globalStyles.input}
            placeholder="City"
            placeholderTextColor={globalStyles.COLORS.placeholder}
            value={city}
            onChangeText={setCity}
            autoCapitalize="words"
            editable={!isLoading}
          />
          <TextInput
            style={globalStyles.input}
            placeholder="Country"
            placeholderTextColor={globalStyles.COLORS.placeholder}
            value={country}
            onChangeText={setCountry}
            autoCapitalize="words"
            editable={!isLoading}
          />
          <TextInput
            style={globalStyles.input}
            placeholder="Postal Code"
            placeholderTextColor={globalStyles.COLORS.placeholder}
            keyboardType="default"
            value={postalCode}
            onChangeText={setPostalCode}
            editable={!isLoading}
          />
          {errorMessage ? <Text style={globalStyles.textError}>{errorMessage}</Text> : null}
          <TouchableOpacity
            style={[globalStyles.button, isLoading && { opacity: 0.7 }, { alignSelf: 'center' }]}
            onPress={handleNext}
            disabled={isLoading}
          >
            <Text style={globalStyles.buttonText}>{isLoading ? 'Processing...' : 'Next'}</Text>
          </TouchableOpacity>
        </View>
      </ScrollView>
    </KeyboardAvoidingView>
  );
};

export default SignupStep3;
</DOCUMENT>

c:/AutFinanceBank/src/screens/SignupStep/SignupStep4.js
<DOCUMENT>
import React, { useState } from 'react';
import {
  View,
  Text,
  TextInput,
  TouchableOpacity,
  StyleSheet,
  KeyboardAvoidingView,
  ScrollView,
  Platform,
  Image,
} from 'react-native';
import Icon from 'react-native-vector-icons/MaterialIcons';
import { launchImageLibrary } from 'react-native-image-picker';
import { checkUniqueness } from '../../services/userService';
import globalStyles from '../../styles/globalStyles';

const SignupStep4 = ({ navigation, route }) => {
  const { signupData } = route.params;
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [confirmPassword, setConfirmPassword] = useState('');
  const [profileImage, setProfileImage] = useState(null);
  const [accountType, setAccountType] = useState(null); // Savings or Current
  const [showPassword, setShowPassword] = useState(false);
  const [showConfirmPassword, setShowConfirmPassword] = useState(false);
  const [errorMessage, setErrorMessage] = useState('');
  const [isLoading, setIsLoading] = useState(false);

  const selectImage = () => {
    launchImageLibrary(
      { mediaType: 'photo', quality: 1.0 },
      (response) => {
        if (response.didCancel) {
          console.log('SignupStep4: Image picker cancelled');
        } else if (response.errorCode) {
          console.error('SignupStep4 image picker error:', response.errorMessage);
          setErrorMessage('Failed to select image. Please try again.');
        } else if (response.assets && response.assets[0].uri) {
          setProfileImage(response.assets[0].uri);
          setErrorMessage('');
        }
      }
    );
  };

  const validateInputs = async () => {
    const trimmedEmail = email.trim();
    const trimmedPassword = password.trim();
    const trimmedConfirmPassword = confirmPassword.trim();

    if (!trimmedEmail || !trimmedPassword || !trimmedConfirmPassword) {
      setErrorMessage('Email, password, and confirm password are required');
      return false;
    }

    if (!profileImage) {
      setErrorMessage('Please select a profile picture');
      return false;
    }

    if (!accountType) {
      setErrorMessage('Please select an account type');
      return false;
    }

    if (!['Savings', 'Current'].includes(accountType)) {
      setErrorMessage('Account type must be Savings or Current');
      return false;
    }

    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(trimmedEmail)) {
      setErrorMessage('Please enter a valid email address');
      return false;
    }

    try {
      const result = await checkUniqueness('Email', trimmedEmail);
      if (!result.success || !result.data?.is_unique) {
        setErrorMessage('Email is already taken');
        return false;
      }
    } catch (error) {
      console.error('SignupStep4 checkEmailUniqueAndSendOtp error:', error);
      setErrorMessage('Failed to validate email. Please try again.');
      return false;
    }

    const passwordRegex = /^(?=.*[A-Z])(?=.*\d).{8,}$/;
    if (!passwordRegex.test(trimmedPassword)) {
      setErrorMessage('Password must be at least 8 characters, including an uppercase letter and a number');
      return false;
    }

    if (trimmedPassword !== trimmedConfirmPassword) {
      setErrorMessage('Passwords do not match');
      return false;
    }

    return true;
  };

  const handleNext = async () => {
    setErrorMessage('');
    setIsLoading(true);
    try {
      if (!(await validateInputs())) {
        return;
      }
      // const trimmedData = { email: email.trim(), password: password.trim(), profileImage, AccountType: accountType }; used when image implement
      const trimmedData = { email: email.trim(), password: password.trim(),  AccountType: accountType };
      console.log('SignupStep4: Navigating to SignupStep5 with data:', {
        ...signupData,
        ...trimmedData,
      });
      navigation.navigate('SignupStep5', {
        signupData: {
          ...signupData,
          ...trimmedData,
        },
      });
    } catch (error) {
      console.error('SignupStep4 handleNext error:', error);
      setErrorMessage('An error occurred. Please try again.');
    } finally {
      setIsLoading(false);
    }
  };

  const Checkbox = ({ label, value, selected, onSelect }) => (
    <TouchableOpacity
      style={styles.checkboxContainer}
      onPress={() => onSelect(value)}
      disabled={isLoading}
    >
      <Icon
        name={selected ? 'check-box' : 'check-box-outline-blank'}
        size={24}
        color={selected ? globalStyles.COLORS.primary : globalStyles.COLORS.placeholder}
      />
      <Text style={[styles.checkboxLabel, { color: globalStyles.COLORS.text }]}>{label}</Text>
    </TouchableOpacity>
  );

  return (
    <KeyboardAvoidingView
      style={{ flex: 1 }}
      behavior={Platform.OS === 'ios' ? 'padding' : 'height'}
      keyboardVerticalOffset={Platform.OS === 'ios' ? 0 : 20}
    >
      <ScrollView contentContainerStyle={{ flexGrow: 1 }}>
        <View style={[globalStyles.container, { alignItems: 'flex-start' }]}>
          <View style={[globalStyles.logoContainer, { marginLeft: globalStyles.SPACING.medium, marginTop: globalStyles.SPACING.large }]}>
            <View style={[globalStyles.circle, globalStyles.circlePrimary]} />
            <View style={[globalStyles.circle, globalStyles.circleSecondary]} />
          </View>
          <Text style={[globalStyles.textXLargeBlack, { marginBottom: globalStyles.SPACING.large, alignSelf: 'center' }]}>
            Sign Up
          </Text>
          <View style={globalStyles.dotContainer}>
            {[...Array(6)].map((_, index) => (
              <View
                key={index}
                style={[
                  globalStyles.dot,
                  index === 3 ? globalStyles.dotActive : globalStyles.dotInactive,
                ]}
              />
            ))}
          </View>
          <TouchableOpacity
            style={[globalStyles.button, styles.imageButton, isLoading && { opacity: 0.7 }]}
            onPress={selectImage}
            disabled={isLoading}
          >
            {profileImage ? (
              <Image
                source={{ uri: profileImage }}
                style={styles.profileImage}
              />
            ) : (
              <Text style={globalStyles.buttonText}>Upload Profile Picture</Text>
            )}
          </TouchableOpacity>
          <TextInput
            style={[globalStyles.input, { color: globalStyles.COLORS.text }]}
            placeholder="Email Address"
            placeholderTextColor={globalStyles.COLORS.placeholder}
            keyboardType="email-address"
            value={email}
            onChangeText={setEmail}
            autoCapitalize="none"
            editable={!isLoading}
          />
          <View style={{ position: 'relative', width: '100%' }}>
            <TextInput
              style={[globalStyles.input, { color: globalStyles.COLORS.text }]}
              placeholder="Password"
              placeholderTextColor={globalStyles.COLORS.placeholder}
              secureTextEntry={!showPassword}
              value={password}
              onChangeText={setPassword}
              editable={!isLoading}
            />
            <TouchableOpacity
              style={styles.eyeIcon}
              onPress={() => setShowPassword(!showPassword)}
              disabled={isLoading}
            >
              <Icon
                name={showPassword ? 'visibility' : 'visibility-off'}
                size={20}
                color={globalStyles.COLORS.placeholder}
              />
            </TouchableOpacity>
          </View>
          <View style={{ position: 'relative', width: '100%' }}>
            <TextInput
              style={[globalStyles.input, { color: globalStyles.COLORS.text }]}
              placeholder="Confirm Password"
              placeholderTextColor={globalStyles.COLORS.placeholder}
              secureTextEntry={!showConfirmPassword}
              value={confirmPassword}
              onChangeText={setConfirmPassword}
              editable={!isLoading}
            />
            <TouchableOpacity
              style={styles.eyeIcon}
              onPress={() => setShowConfirmPassword(!showConfirmPassword)}
              disabled={isLoading}
            >
              <Icon
                name={showConfirmPassword ? 'visibility' : 'visibility-off'}
                size={20}
                color={globalStyles.COLORS.placeholder}
              />
            </TouchableOpacity>
          </View>
          <View style={styles.accountTypeContainer}>
            <Text style={[globalStyles.text, { marginBottom: globalStyles.SPACING.small }]}>
              Account Type
            </Text>
            <View style={styles.checkboxRow}>
              <Checkbox
                label="Savings"
                value="Savings"
                selected={accountType === 'Savings'}
                onSelect={setAccountType}
              />
              <Checkbox
                label="Current"
                value="Current"
                selected={accountType === 'Current'}
                onSelect={setAccountType}
              />
            </View>
          </View>
          {errorMessage ? <Text style={globalStyles.textError}>{errorMessage}</Text> : null}
          <TouchableOpacity
            style={[globalStyles.button, isLoading && { opacity: 0.7 }, { alignSelf: 'center' }]}
            onPress={handleNext}
            disabled={isLoading}
          >
            <Text style={globalStyles.buttonText}>{isLoading ? 'Checking...' : 'Next'}</Text>
          </TouchableOpacity>
        </View>
      </ScrollView>
    </KeyboardAvoidingView>
  );
};

const styles = StyleSheet.create({
  eyeIcon: {
    position: 'absolute',
    right: 10,
    top: '50%',
    transform: [{ translateY: -10 }],
  },
  imageButton: {
    width: 120,
    height: 120,
    borderRadius: 60,
    justifyContent: 'center',
    alignItems: 'center',
    alignSelf: 'center',
    marginBottom: globalStyles.SPACING.medium,
  },
  profileImage: {
    width: 120,
    height: 120,
    borderRadius: 60,
  },
  accountTypeContainer: {
    width: '100%',
    marginTop: globalStyles.SPACING.medium,
    marginBottom: globalStyles.SPACING.medium,
  },
  checkboxRow: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    paddingHorizontal: globalStyles.SPACING.medium,
  },
  checkboxContainer: {
    flexDirection: 'row',
    alignItems: 'center',
  },
  checkboxLabel: {
    fontSize: globalStyles.FONT_SIZES.medium,
    marginLeft: globalStyles.SPACING.small,
  },
});

export default SignupStep4;
</DOCUMENT>

c:/AutFinanceBank/src/screens/SignupStep/SignupStep5.js
<DOCUMENT>
import React, { useState, useEffect, useRef } from 'react';
import {
  View,
  Text,
  TextInput,
  TouchableOpacity,
  StyleSheet,
  KeyboardAvoidingView,
  ScrollView,
  Platform,
} from 'react-native';
import { sendVerification } from '../../services/userService';
import generateOtpEmail from '../../Assets/mailbody';
import globalStyles from '../../styles/globalStyles';
import { secret_code } from '@env';

const SignupStep5 = ({ navigation, route }) => {
  const { signupData } = route.params;
  const [otp, setOtp] = useState(['', '', '', '', '', '']);
  const [generatedOtp, setGeneratedOtp] = useState('');
  const [errorMessage, setErrorMessage] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  const [resendLoading, setResendLoading] = useState(false);
  const [otpSent, setOtpSent] = useState(false);
  const [timer, setTimer] = useState(0); // Timer state in seconds

  const refs = useRef(Array(6).fill().map(() => React.createRef()));

  useEffect(() => {
    if (!otpSent) {
      sendOtp();
    }
  }, [otpSent]);

  useEffect(() => {
    let interval;
    if (timer > 0) {
      interval = setInterval(() => {
        setTimer((prev) => prev - 1);
      }, 1000);
    }
    return () => clearInterval(interval);
  }, [timer]);

  const generateOtp = () => {
    return Math.floor(100000 + Math.random() * 900000).toString();
  };

  const sendOtp = async () => {
    const otpToSend = generateOtp();
    setGeneratedOtp(otpToSend);
    setErrorMessage('');
    setResendLoading(true);
    setTimer(30); // Start 30-second timer

    const date = new Date();
    const reason = "Account verification";
    const emailContent = generateOtpEmail(date, reason, otpToSend);

    const payload = {
      email: signupData.email,
      content: emailContent,
      type: 'otp',
      secret_code,
    };

    try {
      const result = await sendVerification(payload);
      console.log('OTP sent:', otpToSend);
      if (!result.success) {
        setErrorMessage(result.message);
      } else {
        setOtpSent(true);
      }
    } catch (error) {
      console.error('Error sending OTP:', error);
      setErrorMessage('Failed to send OTP. Please try again.');
    } finally {
      setResendLoading(false);
    }
  };

  const handleOtpChange = (value, index) => {
    const trimmedValue = value.trim();
    if (trimmedValue.length > 1) return;

    const newOtp = [...otp];
    newOtp[index] = trimmedValue;
    setOtp(newOtp);
    setErrorMessage('');

    if (trimmedValue && index < 5) {
      refs.current[index + 1].current.focus();
    } else if( index > 0) {
      refs.current[index - 1].current.focus();
    }
  };

  const validateOtp = () => {
    const otpString = otp.join('');
    if (otpString.length !== 6 || isNaN(otpString)) {
      setErrorMessage('Please enter a valid 6-digit OTP');
      return false;
    }

    if (otpString !== generatedOtp) {
      setErrorMessage('OTP does not match');
      return false;
    }

    return true;
  };

  const handleVerify = async () => {
    setIsLoading(true);
    try {
      if (!validateOtp()) return;
      navigation.navigate('SignupStep6', { signupData });
    } catch (error) {
      console.error('Verification error:', error);
      setErrorMessage('An error occurred. Please try again.');
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <KeyboardAvoidingView
      style={{ flex: 1 }}
      behavior={Platform.OS === 'ios' ? 'padding' : 'height'}
      keyboardVerticalOffset={Platform.OS === 'ios' ? 0 : 20}
    >
      <ScrollView contentContainerStyle={{ flexGrow: 1 }}>
        <View style={[globalStyles.container, { alignItems: 'flex-start' }]}>
          <View style={[globalStyles.logoContainer, { marginLeft: globalStyles.SPACING.medium, marginTop: globalStyles.SPACING.large }]}>
            <View style={[globalStyles.circle, globalStyles.circlePrimary]} />
            <View style={[globalStyles.circle, globalStyles.circleSecondary]} />
          </View>

          <Text style={[globalStyles.textXLargeBlack, { marginBottom: globalStyles.SPACING.large, alignSelf: 'center' }]}>
            Email Verification
          </Text>

          <View style={globalStyles.dotContainer}>
            {[...Array(6)].map((_, index) => (
              <View
                key={index}
                style={[
                  globalStyles.dot,
                  index === 4 ? globalStyles.dotActive : globalStyles.dotInactive,
                ]}
              />
            ))}
          </View>

          <View style={{ flexDirection: 'row', justifyContent: 'space-between', width: globalStyles.input.width }}>
            {otp.map((digit, index) => (
              <TextInput
                key={index}
                ref={refs.current[index]}
                style={[styles.otpInput, { borderColor: errorMessage ? globalStyles.COLORS.error : globalStyles.COLORS.gray }]}
                keyboardType="numeric"
                maxLength={1}
                value={digit}
                onChangeText={(value) => handleOtpChange(value, index)}
                editable={!isLoading}
              />
            ))}
          </View>

          {errorMessage ? <Text style={globalStyles.textError}>{errorMessage}</Text> : null}

          <TouchableOpacity
            style={[globalStyles.button, isLoading && { opacity: 0.7 }, { alignSelf: 'center' }]}
            onPress={handleVerify}
            disabled={isLoading}
          >
            <Text style={globalStyles.buttonText}>
              {isLoading ? 'Verifying...' : 'Verify OTP'}
            </Text>
          </TouchableOpacity>

          <TouchableOpacity
            onPress={sendOtp}
            disabled={timer > 0 || resendLoading}
            style={{ marginTop: globalStyles.SPACING.medium, alignSelf: 'center' }}
          >
            <Text style={[globalStyles.textLink, timer > 0 && { opacity: 0.5 }]}>
              {resendLoading ? 'Resending...' : timer > 0 ? `Resend OTP in ${timer}s` : 'Resend OTP'}
            </Text>
          </TouchableOpacity>
        </View>
      </ScrollView>
    </KeyboardAvoidingView>
  );
};

const styles = StyleSheet.create({
  otpInput: {
    width: 40,
    height: 50,
    borderWidth: 1,
    borderRadius: 8,
    textAlign: 'center',
    fontSize: globalStyles.FONT_SIZES.medium,
    marginHorizontal: 5,
    color: globalStyles.COLORS.text,
  },
});

export default SignupStep5;
</DOCUMENT>

c:/AutFinanceBank/src/screens/SignupStep/SignupStep6.js
<DOCUMENT>
import React, { useEffect, useState } from 'react';
import { View, Text, TouchableOpacity, StyleSheet } from 'react-native';
import { registerUser } from '../../services/userService';
import { formatCnic } from '../../utils/helpers';
import globalStyles from '../../styles/globalStyles';

const SignupStep6 = ({ navigation, route }) => {
  const { signupData } = route.params;
  const [errorMessage, setErrorMessage] = useState('');
  const [isLoading, setIsLoading] = useState(true);

  useEffect(() => {
    const submitData = async () => {
      try {
        const userData = {
          Username: signupData.username,
          FirstName: signupData.firstName,
          LastName: signupData.lastName,
          StreetAddress: signupData.streetAddress,
          City: signupData.city,
          Country: signupData.country,
          PostalCode: signupData.postalCode,
          PhoneNumber: signupData.phoneNumber,
          CNIC: formatCnic(signupData.cnic),
          Email: signupData.email,
          Password: signupData.password,
          AccountType: signupData.AccountType, 
          DateOfBirth: signupData.dateOfBirth,
          IsActive: false,
        };
        console.log('SignupStep6: Sending userData:', userData);
        
        const result = await registerUser(userData);
        if (result.success) {
          console.log('SignupStep6: User registered successfully');
          setIsLoading(false);
        } else {
          
          setErrorMessage(result.message);
          setIsLoading(false);
        }
      } catch (error) {
        console.error('SignupStep6 submitData error:', error);
        
        setErrorMessage(error.message || 'An error occurred while registering');
        setIsLoading(false);
      }
    };

    submitData();
  }, [signupData]);

  return (
    <View style={[globalStyles.container, { alignItems: 'flex-start' }]}>
      <View style={[globalStyles.logoContainer, { marginLeft: globalStyles.SPACING.medium, marginTop: globalStyles.SPACING.large }]}>
        <View style={[globalStyles.circle, globalStyles.circlePrimary]} />
        <View style={[globalStyles.circle, globalStyles.circleSecondary]} />
      </View>
      <Text style={[globalStyles.textXLargeBlack, { marginBottom: globalStyles.SPACING.large, alignSelf: 'center' }]}>
        Account Created
      </Text>
      <View style={globalStyles.dotContainer}>
        {[...Array(6)].map((_, index) => (
          <View
            key={index}
            style={[
              globalStyles.dot,
              index === 5 ? globalStyles.dotActive : globalStyles.dotInactive,
            ]}
          />
        ))}
      </View>
      {isLoading ? (
        <Text style={[globalStyles.text, { textAlign: 'center', marginVertical: globalStyles.SPACING.large }]}>
          Your account is being created. Please wait...
        </Text>
      ) : errorMessage ? (
        <Text style={[globalStyles.textError, { textAlign: 'center', marginVertical: globalStyles.SPACING.large }]}>
          {errorMessage}
        </Text>
      ) : (
        <View style={styles.messageContainer}>
          <Text style={styles.successMessage}>
            Waiting for admin approval, we will notify you via email once approved.
          </Text>
        </View>
      )}
      {!isLoading && (
        <TouchableOpacity
          style={[globalStyles.button, styles.loginButton, { alignSelf: 'center' }]}
          onPress={() => navigation.replace('Login')}
        >
          <Text style={globalStyles.buttonText}>Go to Login</Text>
        </TouchableOpacity>
      )}
    </View>
  );
};

const styles = StyleSheet.create({
  messageContainer: {
    backgroundColor: globalStyles.COLORS.primary,
    borderRadius: 10,
    padding: 15,
    marginVertical: globalStyles.SPACING.large,
    marginHorizontal: 20,
    alignItems: 'center',
  },
  successMessage: {
    fontSize: 18,
    fontWeight: 'bold',
    color: globalStyles.COLORS.white,
    textAlign: 'center',
    lineHeight: 24,
  },
  loginButton: {
    backgroundColor: globalStyles.COLORS.secondary,
    width: '60%',
  },
});

export default SignupStep6;
</DOCUMENT>

c:/AutFinanceBank/src/services/api.js
<DOCUMENT>
import axios from 'axios';
import AsyncStorage from '@react-native-async-storage/async-storage';
import { API_BASE_URL } from '@env';

const api = axios.create({
  baseURL: API_BASE_URL,
  headers: {
    'Content-Type': 'application/json',
    'Accept': 'application/json',
  },
});

// List of endpoints that DO NOT require token
const skipAuthRoutes = [
  '/api/v1/users/check_uniqueness',
  '/api/v1/users/send_verification',
  '/api/v1/users/register',
  '/api/v1/users/login',
  '/api/v1/users/refresh',
];

api.interceptors.request.use(async (config) => {
  if (!config.url) {
    console.error('Request config.url is undefined');
    return config;
  }

  const url = config.url.startsWith('http') && config.baseURL
    ? config.url.replace(config.baseURL, '')
    : config.url;

  if (!skipAuthRoutes.includes(url)) {
    const token = await AsyncStorage.getItem('accessToken');
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
  }

  console.log('api.js: Request:', config.method.toUpperCase(), config.url, config.headers);
  return config;
});


api.interceptors.response.use(
  (response) => {
    console.log('api.js: Response:', response.status, response.data);
    return response;
  },
  (error) => {
    console.error('api.js: Response error:', error.response?.status, error.response?.data || error.message);
    return Promise.reject(error);
  }
);

export default api;
</DOCUMENT>

c:/AutFinanceBank/src/services/cloudinaryService.js
<DOCUMENT>
// cloudinaryService.js

import axios from 'axios';
import { CLOUDINARY_CLOUD_NAME, CLOUDINARY_UPLOAD_PRESET, CLOUDINARY_FOLDER } from '@env';

const CLOUDINARY_UPLOAD_URL = `https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/image/upload`;
const CLOUDINARY_IMAGE_BASE_URL = `https://res.cloudinary.com/${CLOUDINARY_CLOUD_NAME}/image/upload`;

/**
 * Upload image using unsigned preset
 * @param {string} imageUri - Local image URI
 * @param {string} publicId - Path like "user_profile/username" or "recipients/username/recipient"
 * @returns {Promise<string>} - Secure image URL
 */
const uploadImage = async (imageUri, publicId) => {
  const fullPublicId = `${CLOUDINARY_FOLDER}/${publicId}`;

  const formData = new FormData();
  formData.append('file', {
    uri: imageUri,
    name: `${publicId}.jpg`,  // Appending the extension for the upload process
    type: 'image/jpeg',
  });
  formData.append('upload_preset', CLOUDINARY_UPLOAD_PRESET);
  formData.append('public_id', fullPublicId);

  const res = await axios.post(CLOUDINARY_UPLOAD_URL, formData, {
    headers: { 'Content-Type': 'multipart/form-data' },
  });

  return res.data.secure_url;
};

// ========== Upload Handlers ==========

export const uploadUserProfileImage = async (imageUri, username) => {
  // Use only username for public_id (no timestamp)
  const publicId = `user_profile/${username}`;
  return await uploadImage(imageUri, publicId);
};

export const uploadRecipientImage = async (imageUri, username, recipientName) => {
  // Use only recipientName for public_id (no timestamp)
  const publicId = `recipients/${username}/${recipientName}`;
  return await uploadImage(imageUri, publicId);
};

// ========== Get Image URL ==========

export const getUserProfileImageUrl = (username) => {
  return `${CLOUDINARY_IMAGE_BASE_URL}/${CLOUDINARY_FOLDER}/user_profile/${username}.jpg`;
};

export const getRecipientImageUrl = (username, recipientName) => {
  return `${CLOUDINARY_IMAGE_BASE_URL}/${CLOUDINARY_FOLDER}/recipients/${username}/${recipientName}.jpg`;
};

export const getAllRecipientImages = (username, recipientNames) => {
  return recipientNames.map((name) => ({
    name,
    imageUrl: getRecipientImageUrl(username, name),
  }));
};
</DOCUMENT>

c:/AutFinanceBank/src/services/loanService.js
<DOCUMENT>
import api from './api';

export const applyForLoan = async (loanData) => {
  return api.post('/users/loans/apply', loanData);
};

export const getLoanTypes = async () => {
  return api.get('/users/loans/types');
};

export const makeLoanPayment = async (paymentData) => {
  return api.post('/users/loans/payments', paymentData);
};

export const getLoans = async (params) => {
  return api.get('/users/loans', { params });
};

export const getLoanPayments = async (loanId, params) => {
  return api.get(`/users/loans/${loanId}/payments`, { params });
};
</DOCUMENT>

c:/AutFinanceBank/src/services/mockData.js
<DOCUMENT>
// services/mockData.js
export const mockUsers = [
  {
    userId: 1,
    username: 'manidoe',
    firstName: 'Mani',
    lastName: 'Doe',
    email: 'mani.doe@example.com',
    password: 'password123',
    cnic: '12345-6789012-3',
    accountType: 'Savings',
    balance: 285856.20,
    phoneNumber: '+1234567890',
    streetAddress: '123 Main St',
    city: 'Karachi',
    country: 'Pakistan',
    postalCode: '75000',
    dateOfBirth: '1990-01-15',
    isActive: true,
    createdAt: '2025-01-01T10:00:00Z',
    profileImage: require('../Assets/images/users/user1.jpg'),
    incomingTransactions: [
      {
        id: 1,
        senderId: 2,
        senderName: 'Johnny Bairstow',
        amount: 54.23,
        date: '2020-12-23',
        referenceNumber: 'TRX001',
      },
      {
        id: 2,
        senderId: 3,
        senderName: 'Charles Smith',
        amount: 62.54,
        date: '2020-12-22',
        referenceNumber: 'TRX002',
      },
    ],
    outgoingTransactions: [
      {
        id: 1,
        recipientId: 4,
        recipientName: 'John Brown',
        amount: 396.84,
        date: '2021-12-12',
        referenceNumber: 'TRX003',
      },
      {
        id: 2,
        recipientId: 5,
        recipientName: 'Mellony Jane',
        amount: 45.21,
        date: '2021-12-12',
        referenceNumber: 'TRX004',
      },
    ],
  },
  {
    userId: 2,
    username: 'johnnyb',
    firstName: 'Johnny',
    lastName: 'Bairstow',
    email: 'johnny.b@example.com',
    password: 'pass456',
    cnic: '54321-0987654-3',
    accountType: 'Current',
    balance: 15000.75,
    phoneNumber: '+1987654321',
    streetAddress: '456 Oak Ave',
    city: 'Lahore',
    country: 'Pakistan',
    postalCode: '54000',
    dateOfBirth: '1985-03-22',
    isActive: true,
    createdAt: '2025-02-01T12:00:00Z',
    profileImage: require('../Assets/images/users/user2.jpg'),
    incomingTransactions: [],
    outgoingTransactions: [
      {
        id: 3,
        recipientId: 1,
        recipientName: 'Mani Doe',
        amount: 54.23,
        date: '2020-12-23',
        referenceNumber: 'TRX001',
      },
    ],
  },
  {
    userId: 3,
    username: 'charless',
    firstName: 'Charles',
    lastName: 'Smith',
    email: 'charles.s@example.com',
    password: 'pass789',
    cnic: '67890-1234567-8',
    accountType: 'Savings',
    balance: 7500.30,
    phoneNumber: '+1122334455',
    streetAddress: '789 Pine Rd',
    city: 'Islamabad',
    country: 'Pakistan',
    postalCode: '44000',
    dateOfBirth: '1992-07-10',
    isActive: false,
    createdAt: '2025-03-01T15:00:00Z',
    profileImage: require('../Assets/images/users/user3.jpg'),
    incomingTransactions: [],
    outgoingTransactions: [
      {
        id: 4,
        recipientId: 1,
        recipientName: 'Mani Doe',
        amount: 62.54,
        date: '2020-12-22',
        referenceNumber: 'TRX002',
      },
    ],
  },
];

export const mockRecipients = [
  {
    recipientId: 1,
    name: 'Johnny Baistow',
    email: 'johnny.b@example.com',
    image: require('../Assets/images/recipients/recipients1.jpg'),
  },
  {
    recipientId: 2,
    name: 'Johnny Baistow',
    email: 'johnny.b@example.com',
    image: require('../Assets/images/recipients/recipients1.jpg'),
  },
  {
    recipientId: 3,
    name: 'Johnny Baistow',
    email: 'johnny.b@example.com',
    image: require('../Assets/images/recipients/recipients1.jpg'),
  },
  {
    recipientId: 4,
    name: 'Johnny Baistow',
    email: 'johnny.b@example.com',
    image: require('../Assets/images/recipients/recipients1.jpg'),
  },
  {
    recipientId: 5,
    name: 'Charles Smith',
    email: 'charles.s@example.com',
    image: require('../Assets/images/recipients/recipients2.jpg'),
  },
  {
    recipientId: 6,
    name: 'John Brown',
    email: 'john.brown@example.com',
    image: require('../Assets/images/recipients/recipients3.jpg'),
  },
  {
    recipientId: 7,
    name: 'Mellony Jane',
    email: 'mellony.j@example.com',
    image: require('../Assets/images/recipients/recipients4.jpg'),
  },
];
</DOCUMENT>

c:/AutFinanceBank/src/services/RecipientsData.js
<DOCUMENT>
export const mockRecipients = [
  {
    recipientId: 1,
    name: 'John Doe',
    username: 'johndoe',
    email: 'john.doe@example.com',
    image: 'https://images.unsplash.com/photo-1500648767791-00dcc994a43e?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&q=80',
  },
  {
    recipientId: 2,
    name: 'Jane Smith',
    username: 'janesmith',
    email: 'jane.smith@example.com',
    image: 'https://images.unsplash.com/photo-1494790108377-be9c29b29330?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&q=80',
  },
  {
    recipientId: 3,
    name: 'Michael Brown',
    username: 'michaelb',
    email: 'michael.brown@example.com',
    image: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&q=80',
  },
  {
    recipientId: 4,
    name: 'Emily Davis',
    username: 'emilyd',
    email: 'emily.davis@example.com',
    image: 'https://images.unsplash.com/photo-1517841905240-472988babdf9?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&q=80',
  },
  {
    recipientId: 5,
    name: 'David Wilson',
    username: 'davidw',
    email: 'david.wilson@example.com',
    image: 'https://images.unsplash.com/photo-1506794778202-6d1d69059799?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&q=80',
  },
  {
    recipientId: 6,
    name: 'Sarah Johnson',
    username: 'sarahj',
    email: 'sarah.johnson@example.com',
    image: 'https://images.unsplash.com/photo-1488426862026-3ee34a7d66df?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&q=80',
  },
  {
    recipientId: 7,
    name: 'Chris Lee',
    username: 'chrisl',
    email: 'chris.lee@example.com',
    image: 'https://images.unsplash.com/photo-1522556189639-b1509e2e2662?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&q=80',
  },
  {
    recipientId: 8,
    name: 'Laura Martinez',
    username: 'lauram',
    email: 'laura.martinez@example.com',
    image: 'https://images.unsplash.com/photo-1517365830460-955ce3f6b1f7?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&q=80',
  },
  {
    recipientId: 9,
    name: 'James Taylor',
    username: 'jamest',
    email: 'james.taylor@example.com',
    image: 'https://images.unsplash.com/photo-1503023345310-bd7c1de61c7d?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&q=80',
  },
  {
    recipientId: 10,
    name: 'Olivia Anderson',
    username: 'oliviaa',
    email: 'olivia.anderson@example.com',
    image: 'https://images.unsplash.com/photo-1499952127939-9bbf5af6c51c?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&q=80',
  },
  {
    recipientId: 11,
    name: 'Robert Thomas',
    username: 'robertt',
    email: 'robert.thomas@example.com',
    image: 'https://images.unsplash.com/photo-1519345182560-3f2917c472ef?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&q=80',
  },
  {
    recipientId: 12,
    name: 'Sophia Jackson',
    username: 'sophiaj',
    email: 'sophia.jackson@example.com',
    image: 'https://images.unsplash.com/photo-1512314889357-e1573b96c762?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&q=80',
  },
  {
    recipientId: 13,
    name: 'William White',
    username: 'williamw',
    email: 'william.white@example.com',
    image: 'https://images.unsplash.com/photo-1504257432389-52343af06ae3?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&q=80',
  },
  {
    recipientId: 14,
    name: 'Isabella Harris',
    username: 'isabellah',
    email: 'isabella.harris@example.com',
    image: 'https://images.unsplash.com/photo-1516223725307-6e76e5b591b4?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&q=80',
  },
  {
    recipientId: 15,
    name: 'Daniel Clark',
    username: 'danielc',
    email: 'daniel.clark@example.com',
    image: 'https://images.unsplash.com/photo-1506085452766-c330853bea50?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&q=80',
  },
];
</DOCUMENT>

c:/AutFinanceBank/src/services/recipientStorage.js
<DOCUMENT>
import AsyncStorage from '@react-native-async-storage/async-storage';
import {getUserDetails} from './userService'
// Default image path for recipients
const DEFAULT_IMAGE_PATH = 'https://via.placeholder.com/200?text=Default+User';

// Store the current user ID
let currentUserId = null;

// Set the current user's ID
const setUserId = async (userId) => {
  if (!userId) {
    console.error(`recipientStorage: setUserId failed - UserID is missing`);
    throw new Error('UserID is required');
  }
  currentUserId = userId;
  console.log('recipientStorage: Set UserID:', userId);
  return true; // Removed initializeRecipients call to avoid implicit data access
};

// Get user-specific storage key
const getStorageKey = (userId) => {
  if (!userId) {
    console.error(`recipientStorage: getStorageKey failed - UserID is missing`);
    throw new Error('UserID is required');
  }
  return `@recipients:${userId}`;
};

// Initialize local storage for a user (only reads, does not modify)
const initializeRecipients = async (userId) => {
  try {
    console.log(`recipientStorage: Initializing recipients for user ${userId}`);
    const storageKey = getStorageKey(userId);
    const storedRecipients = await AsyncStorage.getItem(storageKey);
    if (storedRecipients) {
      const parsedRecipients = JSON.parse(storedRecipients);
      console.log(`recipientStorage: Found ${parsedRecipients.length} recipients in local storage for user ${userId}`);
      return parsedRecipients;
    }
    console.log(`recipientStorage: No local storage found for user ${userId}, returning empty array`);
    return [];
  } catch (error) {
    console.error(`recipientStorage: Error initializing recipients for user ${userId}: ${error.message}`);
    throw new Error('Failed to initialize recipients');
  }
};

// Save a new recipient to local storage for a user
const saveRecipient = async (userId, recipient) => {
  try {
    console.log(`recipientStorage: Saving recipient for user ${userId}`);
    const storageKey = getStorageKey(userId);
    const storedRecipients = await AsyncStorage.getItem(storageKey);
    const recipients = storedRecipients ? JSON.parse(storedRecipients) : [];

    const maxId = recipients.length > 0 ? Math.max(...recipients.map(r => r.recipientId)) : 0;
    const newRecipient = {
      recipientId: maxId + 1,
      name: recipient.name,
      username: recipient.username,
      ...(recipient.email && { email: recipient.email }),
      ...(recipient.cnic && { cnic: recipient.cnic }),
      image: recipient.image || DEFAULT_IMAGE_PATH,
    };

    const updatedRecipients = [...recipients, newRecipient];
    await AsyncStorage.setItem(storageKey, JSON.stringify(updatedRecipients));

    // Verify save
    const savedData = await AsyncStorage.getItem(storageKey);
    if (!savedData) {
      console.error(`recipientStorage: Verification failed - No data found after saving for user ${userId}`);
      throw new Error('Failed to verify saved data');
    }
    const parsedData = JSON.parse(savedData);
    console.log(`recipientStorage: Saved new recipient for user ${userId}, total ${parsedData.length} recipients`);

    return newRecipient;
  } catch (error) {
    console.error(`recipientStorage: Error saving recipient for user ${userId}: ${error.message}`);
    throw new Error('Failed to save recipient');
  }
};

// Get all recipients from local storage for a user
const getRecipients = async (userId) => {
  try {
    console.log(`recipientStorage: Retrieving recipients for user ${userId}`);
    const storageKey = getStorageKey(userId);
    const storedRecipients = await AsyncStorage.getItem(storageKey);
    if (storedRecipients) {
      const recipients = JSON.parse(storedRecipients);
      console.log(`recipientStorage: Retrieved ${recipients.length} recipients for user ${userId}`);
      return recipients;
    }
    console.log(`recipientStorage: No recipients found for user ${userId}, returning empty array`);
    return [];
  } catch (error) {
    console.error(`recipientStorage: Error retrieving recipients for user ${userId}: ${error.message}`);
    throw new Error('Failed to retrieve recipients');
  }
};

// Delete one or all recipients from local storage for a user
const deleteRecipients = async (userId, recipientId = null) => {
  try {
    console.log(`recipientStorage: Deleting recipients for user ${userId}, recipientId: ${recipientId || 'all'}`);
    const storageKey = getStorageKey(userId);
    const storedRecipients = await AsyncStorage.getItem(storageKey);
    let recipients = storedRecipients ? JSON.parse(storedRecipients) : [];

    if (recipientId) {
      recipients = recipients.filter(r => r.recipientId !== recipientId);
      console.log(`recipientStorage: Deleted recipient ${recipientId} for user ${userId}`);
    } else {
      recipients = [];
      console.log(`recipientStorage: Deleted all recipients for user ${userId}`);
    }

    await AsyncStorage.setItem(storageKey, JSON.stringify(recipients));

    // Verify save
    const savedData = await AsyncStorage.getItem(storageKey);
    const parsedData = savedData ? JSON.parse(savedData) : [];
    console.log(`recipientStorage: Verified ${parsedData.length} recipients remain for user ${userId}`);

    return parsedData;
  } catch (error) {
    console.error(`recipientStorage: Error deleting recipients for user ${userId}: ${error.message}`);
    throw new Error('Failed to delete recipients');
  }
};

// Clear all recipients from local storage for a user (for testing/resetting)
const clearRecipients = async (userId) => {
  try {
    console.log(`recipientStorage: Clearing recipients for user ${userId}`);
    const storageKey = getStorageKey(userId);
    await AsyncStorage.removeItem(storageKey);
    console.log(`recipientStorage: Cleared all recipients for user ${userId}`);

    // Verify clear
    const savedData = await AsyncStorage.getItem(storageKey);
    if (savedData) {
      console.error(`recipientStorage: Verification failed - Data still exists after clearing for user ${userId}`);
      throw new Error('Failed to verify cleared data');
    }
    console.log(`recipientStorage: Verified no recipients remain for user ${userId}`);
    return true;
  } catch (error) {
    console.error(`recipientStorage: Error clearing recipients for user ${userId}: ${error.message}`);
    throw new Error('Failed to clear recipients');
  }
};

// Reset to local storage (for testing)
const resetToLocalStorage = async (userId) => {
  try {
    console.log(`recipientStorage: Resetting to local storage for user ${userId}`);
    const storageKey = getStorageKey(userId);
    const storedRecipients = await AsyncStorage.getItem(storageKey);
    if (storedRecipients) {
      const parsedRecipients = JSON.parse(storedRecipients);
      console.log(`recipientStorage: Reset to local storage for user ${userId} with ${parsedRecipients.length} recipients`);
      return parsedRecipients;
    }
    console.log(`recipientStorage: No local storage found for user ${userId}, returning empty array`);
    return [];
  } catch (error) {
    console.error(`recipientStorage: Error resetting to local storage for user ${userId}: ${error.message}`);
    throw new Error('Failed to reset to local storage');
  }
};

import { mockRecipients } from './RecipientsData';
const saveMockRecipients = async (userId) => {
  console.log(`recipientStorage: Saving mockRecipients for user ${userId}`);
    try {
      if (!userId) {
        console.error(`recipientStorage: saveMockRecipients failed - UserID is missing`);
        throw new Error('UserID is required');
      }
  
      const storageKey = `@recipients:${userId}`;
  
      // Delete existing data
      const existingData = await AsyncStorage.getItem(storageKey);
      if (existingData) {
        console.log(`recipientStorage: Deleting existing data for user ${userId}`);
        await AsyncStorage.removeItem(storageKey);
      }
      
      // Save mockRecipients
      await AsyncStorage.setItem(storageKey, JSON.stringify(mockRecipients));
      console.log(`recipientStorage: Saved ${mockRecipients.length} recipients for user ${userId}`);
      
      // Verify save
      const savedData = await AsyncStorage.getItem(storageKey);
      if (!savedData) {
        console.error(`recipientStorage: Verification failed - No data found after saving for user ${userId}`);
        throw new Error('Failed to verify saved data');
      }
      const parsedData = JSON.parse(savedData);
      console.log(`recipientStorage: Verified saved ${parsedData.length} recipients for user ${userId}`);
  
      return mockRecipients;
    } catch (error) {
      console.error(`recipientStorage: Error in saveMockRecipients: ${error.message}`);
      throw error;
    }
  };
    
  // saveMockRecipients(6)
  export { setUserId, initializeRecipients, saveRecipient, getRecipients, deleteRecipients, clearRecipients, resetToLocalStorage,saveMockRecipients };
</DOCUMENT>

c:/AutFinanceBank/src/services/socket.js
<DOCUMENT>
import AsyncStorage from '@react-native-async-storage/async-storage';
import { WS_BASE_URL } from '@env';
import api from './api';

const initializeWebSocket = async (accessToken) => {
  const token = accessToken || (await AsyncStorage.getItem('accessToken'));
  if (!token) {
    console.error('socket.js: No access token available');
    return null;
  }

  const wsUrl = `${WS_BASE_URL}/api/v1/ws/user?token=${token}`;
  const ws = new WebSocket(wsUrl);

  ws.onopen = () => {
    console.log('socket.js: WebSocket connected');
    ws.send(JSON.stringify({ type: 'ping' }));
  };

  ws.onmessage = (event) => {
    console.log('socket.js: WebSocket message:', event.data);
  };

  ws.onerror = (error) => {
    console.error('socket.js: WebSocket error:', error);
  };

  ws.onclose = async (event) => {
    console.log(`socket.js: WebSocket closed: Code ${event.code}, Reason: ${event.reason}`);
    if (event.code === 4001) {
      try {
        const refreshToken = await AsyncStorage.getItem('refreshToken');
        const response = await api.post('/api/v1/users/refresh', { refreshToken });
        const newAccessToken = response.data.access_token;
        await AsyncStorage.setItem('accessToken', newAccessToken);
        console.log('socket.js: New Access Token:', newAccessToken);
        return initializeWebSocket(newAccessToken);
      } catch (error) {
        console.error('socket.js: Token refresh failed:', error.response?.data || error.message);
      }
    }
  };

  return ws;
};

export default initializeWebSocket;
</DOCUMENT>

c:/AutFinanceBank/src/services/transactionService.js
<DOCUMENT>
import api from './api';

const getLastTenTransactions = async () => {
  try {
    console.log('transactionService: Fetching last 10 transactions');
    const response = await api.get('/api/v1/users/transactions', {
      params: {
        page: 1,
        per_page: 10,
        sort_by: 'Timestamp',
        order: 'desc',
      },
    });
    console.log('transactionService: Transactions fetched:', response.data);
    return response.data;
  } catch (error) {
    console.error('transactionService: Error fetching transactions:', error.response?.data || error.message);
    throw new Error(error.response?.data?.message || 'Failed to fetch transactions');
  }
};

const exportTransactions = async ({ start_date, end_date, transaction_status, transaction_type } = {}) => {
  try {
    console.log('transactionService: Exporting transactions', { start_date, end_date, transaction_status, transaction_type });
    const response = await api.get('/api/v1/users/transactions/export', {
      params: {
        start_date,
        end_date,
        transaction_status,
        transaction_type,
      },
    });
    console.log('transactionService: Transactions exported:', response.data);
    return response.data;
  } catch (error) {
    console.error('transactionService: Error exporting transactions:', error.response?.data || error.message);
    throw new Error(error.response?.data?.message || 'Failed to export transactions');
  }
};

export { getLastTenTransactions, exportTransactions };
</DOCUMENT>

c:/AutFinanceBank/src/services/transferService.js
<DOCUMENT>
import api from './api';
const createTransfer = async (identifier, amount, description) => {
    try {
      const requestBody = {
        ...(identifier.email && { email: identifier.email }),
        ...(identifier.cnic && { cnic: identifier.cnic }),
        ...(identifier.username && { username: identifier.username }),
        Amount: amount,
        Description: description,
      };
      console.log('transferService: Transfer request body:', requestBody);
      const response = await api.post('/api/v1/users/transfer', requestBody);
      console.log('transferService: Transfer successful:', response.data);
      return response.data;
    } catch (error) {
      console.error('transferService: Error creating transfer:', error.response?.data || error.message);
      throw new Error(error.response?.data?.message || 'Failed to create transfer');
    }
  };
  
  export { createTransfer };
</DOCUMENT>

c:/AutFinanceBank/src/services/userService.js
<DOCUMENT>
import api from './api';

export const getUserDetails = async () => {
  try {
    const response = await api.get('/api/v1/users/me');
    console.log('UserServices: getUserDetails response:', response.data);
    if (response.data.success) {
      return response.data.data;
    }
    throw new Error(response.data.message || 'Failed to fetch user details');
  } catch (error) {
    console.error('UserServices: getUserDetails error:', error.response?.data || error.message);
    throw error;
  }
};

export const getUserTransactions = async (params = {}) => {
  try {
    const defaultParams = {
      page: 1,
      per_page: 10,
      sort_by: 'Timestamp',
      order: 'desc',
    };
    const queryParams = { ...defaultParams, ...params };
    console.log('userService: getUserTransactions params:', queryParams);

    const response = await api.get('/api/v1/users/transactions', {
      params: queryParams,
    });
    console.log('userService: getUserTransactions response:', response.data);
    if (response.data.success) {
      return response.data;
    }
    throw new Error(response.data.message || 'Failed to fetch transactions');
  } catch (error) {
    console.error('userService: getUserTransactions error:', error.response?.data || error.message);
    throw error;
  }
};
export const checkUniqueness = async (field, value) => {
  // Email, CNIC, or Username",
  try {
    const response = await api.post('/api/v1/users/check_uniqueness', { field, value });
    console.log('userService: checkUniqueness response:', response.data);
    if (response.data.success) {
      return response.data;
    }
    throw new Error(response.data.message || 'Failed to check uniqueness');
  } catch (error) {
    console.error('userService: checkUniqueness error:', error.response?.data || error.message);
    throw error;
  }
};
export const sendVerification = async ({ email, content, type , secret_code }) => {
  try {
    const response = await api.post('/api/v1/users/send_verification', {
      email,
      content,
      type,
      secret_code,
    });

    console.log('userService: sendVerification response:', response.data);

    if (response.data.success) {
      return response.data;
    }

    throw new Error(response.data.message || 'Failed to send verification');
  } catch (error) {
    console.error('userService: sendVerification error:', error.response?.data || error.message);
    throw error;
  }
};


export const registerUser = async (userData) => {
  try {
    const response = await api.post('/api/v1/users/register', userData);
    console.log('userService: registerUser response:', response.data);
    if (response.data.success) {
      return response.data;
    }
    throw new Error(response.data.message || 'Failed to register user');
  } catch (error) {
    console.error('userService: registerUser error:', error.response?.data || error.message);
    throw error;
  }
};
export const loginUser = async (loginId, password) => {
  return api.post('/users/login', { login_id: loginId, Password: password });
};
</DOCUMENT>

c:/AutFinanceBank/src/services/withdrawalService.js
<DOCUMENT>
import api from './api';

export const createWithdrawal = async (withdrawalData) => {
  return api.post('/atm/withdraw', withdrawalData);
};
</DOCUMENT>

c:/AutFinanceBank/src/styles/globalStyles.js
<DOCUMENT>
import { StyleSheet, Dimensions } from 'react-native';

// Get screen dimensions for responsive design
const { width, height } = Dimensions.get('screen');

// Color palette
const COLORS = {
  primary: '#d4a373',
  secondary: '#EA7300',
  background: '#FFFFFF',
  text: '#333333',
  placeholder: '#A9A9A9', // Ensure this is a visible color
  success: '#28A745',
  danger: '#DC3545',
  white: '#FFFFFF',
  black: '#000000',
  gray: '#E5E7EB',
  dotActive: '#60A5FA',
  dotInactive: '#D1D5DB',
};

// Font sizes
const FONT_SIZES = {
  tiny: 10,
  small: 12,
  medium: 16,
  large: 20,
  xlarge: 32,
};

// Common spacing
const SPACING = {
  tiny: 4,
  small: 8,
  medium: 16,
  large: 24,
  xlarge: 32,
};

const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: COLORS.background,
    paddingHorizontal: SPACING.medium,
  },
  centeredContainer: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center',
    backgroundColor: COLORS.background,
  },
  text: {
    fontSize: FONT_SIZES.medium,
    color: COLORS.text,
  },
  textTiny: {
    fontSize: FONT_SIZES.tiny,
    color: COLORS.text,
  },
  textSmall: {
    fontSize: FONT_SIZES.small,
    color: COLORS.secondary,
  },
  textSmallGray: {
    fontSize: FONT_SIZES.small,
    color: COLORS.placeholder,
    textAlign: 'center',
  },
  textLarge: {
    fontSize: FONT_SIZES.large,
    color: COLORS.text,
    fontWeight: 'bold',
  },
  textXLarge: {
    fontSize: FONT_SIZES.xlarge,
    color: COLORS.primary,
    fontWeight: 'bold',
  },
  textXLargeBlack: {
    fontSize: FONT_SIZES.xlarge,
    color: COLORS.text,
    fontWeight: 'bold',
  },
  textError: {
    fontSize: FONT_SIZES.small,
    color: COLORS.danger,
    marginBottom: SPACING.small,
  },
  textSuccess: {
    fontSize: FONT_SIZES.small,
    color: COLORS.success,
  },
  logoContainer: {
    flexDirection: 'row',
    alignItems: 'center',
    marginBottom: SPACING.medium,
  },
  circle: {
    width: 60,
    height: 60,
    borderRadius: 30,
  },
  circlePrimary: {
    backgroundColor: COLORS.primary,
    marginRight: -20,
  },
  circleSecondary: {
    backgroundColor: COLORS.secondary,
  },
  button: {
    backgroundColor: COLORS.primary,
    paddingVertical: SPACING.medium,
    paddingHorizontal: SPACING.xlarge,
    borderRadius: 25,
    alignItems: 'center',
    justifyContent: 'center',
    marginVertical: SPACING.small,
    width: width * 0.7,
  },
  buttonText: {
    color: COLORS.white,
    fontSize: FONT_SIZES.medium,
    fontWeight: '600',
  },
  buttonSecondary: {
    backgroundColor: COLORS.secondary,
    paddingVertical: SPACING.medium,
    paddingHorizontal: SPACING.xlarge,
    borderRadius: 25,
    alignItems: 'center',
    justifyContent: 'center',
    marginVertical: SPACING.small,
    width: width * 0.7,
  },
  buttonOutline: {
    borderWidth: 1,
    borderColor: COLORS.primary,
    paddingVertical: SPACING.medium,
    paddingHorizontal: SPACING.xlarge,
    borderRadius: 25,
    alignItems: 'center',
    justifyContent: 'center',
    marginVertical: SPACING.small,
    width: width * 0.7,
  },
  buttonOutlineText: {
    color: COLORS.primary,
    fontSize: FONT_SIZES.medium,
    fontWeight: '600',
  },
  dotContainer: {
    flexDirection: 'row',
    justifyContent: 'center',
    alignItems: 'center',
    marginVertical: SPACING.medium,
  },
  dot: {
    width: 8,
    height: 8,
    borderRadius: 4,
    marginHorizontal: SPACING.tiny,
  },
  dotActive: {
    backgroundColor: COLORS.dotActive,
  },
  dotInactive: {
    backgroundColor: COLORS.dotInactive,
  },
  dotFirst: {
    backgroundColor: COLORS.danger,
  },
  placeholderLogo: {
    fontSize: 100,
    color: COLORS.primary,
    marginBottom: SPACING.medium,
  },
  input: {
  width: '100%',
  height: 50,
  borderWidth: 1,
  borderColor: '#ccc',
  borderRadius: 8,
  paddingHorizontal: 10,
  marginVertical: 10,
  fontSize: 16,
},
  inputFocused: {
    borderColor: COLORS.primary,
    borderWidth: 2,
  },
  inputError: {
    borderColor: COLORS.danger,
    borderWidth: 1,
  },
  inputLabel: {
    fontSize: FONT_SIZES.medium,
    color: COLORS.text,
    marginBottom: SPACING.tiny,
  },
  linkText: {
    fontSize: FONT_SIZES.medium,
    color: COLORS.text,
    marginTop: SPACING.medium,
  },
});

const globalStyles = {
  ...styles,
  SPACING,
  COLORS,
  FONT_SIZES,
};

export default globalStyles;
</DOCUMENT>

c:/AutFinanceBank/src/styles/homeScreenTheme.js
<DOCUMENT>
import globalStyles from './globalStyles';

const defaultHomeScreenTheme = {
  primary: globalStyles.COLORS.primary || '#3498db', // Header, buttons, QR code icon
  white: globalStyles.COLORS.white || '#fff', // Balance card, avatar background
  black: globalStyles.COLORS.black || '#2c3e50', // Text, avatar letter
  secondary: '#7f8c8d', // Balance title, transaction date
  background: '#fff', // Main container, white section
  serviceBackground: '#ecf0f1', // Service item background
  credit: '#2ecc71', // Credit transaction icon/amount
  debit: '#e74c3c', // Debit transaction icon/amount, error text
  link: globalStyles.COLORS.primary || '#3498db', // See All, Retry links
  retryButton: '#3498db', // Retry button background
  retryButtonText: '#fff', // Retry button text
  notificationIcon: '#fff', // Notification icon
};

// Function to create a custom HomeScreen theme
const createHomeScreenTheme = (customColors = {}) => ({
  ...defaultHomeScreenTheme,
  ...customColors,
});

// Export the default theme (can be overridden by calling createHomeScreenTheme)
export const homeScreenTheme = createHomeScreenTheme();

export default homeScreenTheme;
</DOCUMENT>

c:/AutFinanceBank/src/utils/helpers.js
<DOCUMENT>
export const formatCnic = (cnic) => {
    const digits = cnic.replace(/\D/g, '');
    if (digits.length !== 13) return digits;
    return `${digits.slice(0, 5)}-${digits.slice(5, 12)}-${digits.slice(12)}`;
  };
  
  export const formatDate = (date) => {
    const d = new Date(date);
    return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;
  };
  
  export const formatCurrency = (amount) => {
    return `$${Number(amount).toFixed(2)}`;
  };
  
  export const debounce = (func, wait) => {
    let timeout;
    return (...args) => {
      clearTimeout(timeout);
      timeout = setTimeout(() => func(...args), wait);
    };
  };
</DOCUMENT>

c:/AutFinanceBank/src/utils/validators.js
<DOCUMENT>
import * as Yup from 'yup';

export const UserCreateSchema = Yup.object().shape({
  Username: Yup.string().min(3).max(50).required('Username is required'),
  FirstName: Yup.string().max(50).required('First name is required'),
  LastName: Yup.string().max(50).required('Last name is required'),
  StreetAddress: Yup.string().max(255).nullable(),
  City: Yup.string().max(50).nullable(),
  State: Yup.string().max(50).nullable(),
  Country: Yup.string().max(50).nullable(),
  PostalCode: Yup.string().max(20).nullable(),
  PhoneNumber: Yup.string().max(20).nullable(),
  CNIC: Yup.string()
    .matches(/^\d{5}-\d{7}-\d$/, 'Invalid CNIC format (e.g., 12345-6789012-3)')
    .required('CNIC is required'),
  Email: Yup.string().email('Invalid email').required('Email is required'),
  Password: Yup.string().min(8).max(255).required('Password is required'),
  AccountType: Yup.string().oneOf(['Savings', 'Current']).required('Account type is required'),
  DateOfBirth: Yup.string()
    .matches(/^\d{4}-\d{2}-\d{2}$/, 'Invalid date format (YYYY-MM-DD)')
    .required('Date of birth is required'),
});

export const UserLoginSchema = Yup.object().shape({
  login_id: Yup.string().required('Email or username is required'),
  Password: Yup.string().min(8).required('Password is required'),
});

export const UserUpdateSchema = Yup.object().shape({
  Username: Yup.string().min(3).max(50).nullable(),
  FirstName: Yup.string().max(50).nullable(),
  LastName: Yup.string().max(50).nullable(),
  StreetAddress: Yup.string().max(255).nullable(),
  City: Yup.string().max(50).nullable(),
  State: Yup.string().max(50).nullable(),
  Country: Yup.string().max(50).nullable(),
  PostalCode: Yup.string().max(20).nullable(),
  PhoneNumber: Yup.string().max(20).nullable(),
  Email: Yup.string().email('Invalid email').nullable(),
});

export const UserPasswordUpdateSchema = Yup.object().shape({
  CurrentPassword: Yup.string().min(8).required('Current password is required'),
  NewPassword: Yup.string().min(8).required('New password is required'),
});

export const TransferCreateSchema = Yup.object().shape({
  cnic: Yup.string()
    .matches(/^\d{5}-\d{7}-\d$/, 'Invalid CNIC format')
    .nullable(),
  username: Yup.string().min(3).max(50).nullable(),
  email: Yup.string().email('Invalid email').nullable(),
  Amount: Yup.number().positive('Amount must be positive').required('Amount is required'),
  Description: Yup.string().nullable(),
})
  .test('one-of-identifier', 'One of CNIC, username, or email is required', (value) => {
    return !!(value.cnic || value.username || value.email);
  });

export const CardCreateSchema = Yup.object().shape({
  CardNumber: Yup.string()
    .matches(/^\d{16}$/, 'Card number must be 16 digits')
    .required('Card number is required'),
  Pin: Yup.string()
    .matches(/^\d{4}$/, 'PIN must be 4 digits')
    .required('PIN is required'),
  ExpirationDate: Yup.string()
    .matches(/^\d{4}-\d{2}-\d{2}$/, 'Invalid date format (YYYY-MM-DD)')
    .required('Expiration date is required'),
});

export const CardUpdateSchema = Yup.object().shape({
  Pin: Yup.string().matches(/^\d{4}$/, 'PIN must be 4 digits').nullable(),
  Status: Yup.string().oneOf(['Active', 'Inactive', 'Blocked']).nullable(),
});

export const LoanApplySchema = Yup.object().shape({
  LoanTypeID: Yup.number().positive().required('Loan type is required'),
  LoanAmount: Yup.number().positive('Loan amount must be positive').required('Loan amount is required'),
  LoanDurationMonths: Yup.number().positive().required('Loan duration is required'),
  DueDate: Yup.string()
    .matches(/^\d{4}-\d{2}-\d{2}$/, 'Invalid date format (YYYY-MM-DD)')
    .required('Due date is required'),
});

export const LoanPaymentCreateSchema = Yup.object().shape({
  LoanID: Yup.number().positive().required('Loan ID is required'),
  PaymentAmount: Yup.number().positive('Payment amount must be positive').required('Payment amount is required'),
});

export const WithdrawalCreateSchema = Yup.object().shape({
  CardNumber: Yup.string()
    .matches(/^\d{16}$/, 'Card number must be 16 digits')
    .required('Card number is required'),
  Pin: Yup.string()
    .matches(/^\d{4}$/, 'PIN must be 4 digits')
    .required('PIN is required'),
  Amount: Yup.number().positive('Amount must be positive').required('Amount is required'),
});
</DOCUMENT>

